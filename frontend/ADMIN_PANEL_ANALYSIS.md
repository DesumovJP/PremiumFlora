# Premium Flora - ĞĞ´Ğ¼Ñ–Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ: ĞŸĞ¾Ğ²Ğ½Ğ¸Ğ¹ Ñ‚ĞµÑ…Ğ½Ñ–Ñ‡Ğ½Ğ¸Ğ¹ Ğ°Ğ½Ğ°Ğ»Ñ–Ğ·

## Ğ—Ğ¼Ñ–ÑÑ‚

1. [ĞĞ³Ğ»ÑĞ´ Ğ°Ñ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ¸](#1-Ğ¾Ğ³Ğ»ÑĞ´-Ğ°Ñ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ¸)
2. [Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ñ„Ğ°Ğ¹Ğ»Ñ–Ğ²](#2-ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°-Ñ„Ğ°Ğ¹Ğ»Ñ–Ğ²)
3. [ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¸ Ñ‚Ğ° ÑĞµĞºÑ†Ñ–Ñ—](#3-ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¸-Ñ‚Ğ°-ÑĞµĞºÑ†Ñ–Ñ—)
4. [API Ñ‚Ğ° Ğ¿Ğ¾Ñ‚Ñ–Ğº Ğ´Ğ°Ğ½Ğ¸Ñ…](#4-api-Ñ‚Ğ°-Ğ¿Ğ¾Ñ‚Ñ–Ğº-Ğ´Ğ°Ğ½Ğ¸Ñ…)
5. [ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ– Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ğ¾Ğ±Ñ€Ğ¾Ğ±ĞºĞ¸ Ğ´Ğ°Ğ½Ğ¸Ñ…](#5-ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ–-Ñ‚Ğ¾Ñ‡ĞºĞ¸-Ğ¾Ğ±Ñ€Ğ¾Ğ±ĞºĞ¸-Ğ´Ğ°Ğ½Ğ¸Ñ…)
6. [ĞŸĞ¾Ñ‚ĞµĞ½Ñ†Ñ–Ğ¹Ğ½Ñ– Ğ¿Ğ¾Ğ¼Ğ¸Ğ»ĞºĞ¸ Ñ‚Ğ° Ñ€Ğ¸Ğ·Ğ¸ĞºĞ¸](#6-Ğ¿Ğ¾Ñ‚ĞµĞ½Ñ†Ñ–Ğ¹Ğ½Ñ–-Ğ¿Ğ¾Ğ¼Ğ¸Ğ»ĞºĞ¸-Ñ‚Ğ°-Ñ€Ğ¸Ğ·Ğ¸ĞºĞ¸)
7. [ĞĞ±Ñ€Ğ¾Ğ±ĞºĞ° Ğ¿Ğ¾Ğ¼Ğ¸Ğ»Ğ¾Ğº](#7-Ğ¾Ğ±Ñ€Ğ¾Ğ±ĞºĞ°-Ğ¿Ğ¾Ğ¼Ğ¸Ğ»Ğ¾Ğº)
8. [Ğ‘ĞµĞ·Ğ¿ĞµĞºĞ°](#8-Ğ±ĞµĞ·Ğ¿ĞµĞºĞ°)
9. [ĞŸĞ»Ğ°Ğ½ Ğ¿Ğ¾ĞºÑ€Ğ°Ñ‰ĞµĞ½ÑŒ](#9-Ğ¿Ğ»Ğ°Ğ½-Ğ¿Ğ¾ĞºÑ€Ğ°Ñ‰ĞµĞ½ÑŒ)

---

## 1. ĞĞ³Ğ»ÑĞ´ Ğ°Ñ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ¸

### Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ñ–Ñ‡Ğ½Ğ¸Ğ¹ ÑÑ‚ĞµĞº

**Frontend:**
- Next.js 14 (App Router)
- React 18 Ğ· Server/Client Components
- TypeScript Ğ´Ğ»Ñ Ñ‚Ğ¸Ğ¿Ñ–Ğ·Ğ°Ñ†Ñ–Ñ—
- Tailwind CSS Ğ´Ğ»Ñ ÑÑ‚Ğ¸Ğ»Ñ–Ğ·Ğ°Ñ†Ñ–Ñ—
- Radix UI Ğ´Ğ»Ñ Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ¸Ñ… ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ–Ğ²
- GraphQL (graphql-request) Ğ´Ğ»Ñ Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ñ–Ğ² Ğ´Ğ¾ Strapi

**Backend:**
- Strapi v5 (Headless CMS)
- PostgreSQL (Ñ‡ĞµÑ€ĞµĞ· Railway)
- GraphQL plugin Ğ´Ğ»Ñ ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ğ¸Ñ… Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ñ–Ğ¹
- REST API Ğ´Ğ»Ñ ĞºĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ğ¸Ñ… ĞµĞ½Ğ´Ğ¿Ğ¾Ñ–Ğ½Ñ‚Ñ–Ğ² (POS, Analytics, Import)
- DigitalOcean Spaces Ğ´Ğ»Ñ Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½ÑŒ

### ĞÑ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ğ° Ğ´Ñ–Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Frontend (Next.js)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ admin-clientâ”‚  â”‚  sections/  â”‚  â”‚   hooks/    â”‚             â”‚
â”‚  â”‚    .tsx     â”‚â”€â”€â”‚ (5 ÑĞµĞºÑ†Ñ–Ğ¹)  â”‚â”€â”€â”‚ (7 Ñ…ÑƒĞºÑ–Ğ²)   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚         â”‚                â”‚                â”‚                      â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                          â–¼                                       â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚              â”‚    lib/strapi.ts    â”‚                            â”‚
â”‚              â”‚  (API Ğ°Ğ±ÑÑ‚Ñ€Ğ°ĞºÑ†Ñ–Ñ)   â”‚                            â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                          â”‚                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                          â–¼                                       â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚     â”‚              GraphQL + REST               â”‚                â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          â–¼                                       â”‚
â”‚                   Backend (Strapi v5)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ Controllers â”‚  â”‚  Services   â”‚  â”‚   Models    â”‚             â”‚
â”‚  â”‚  (10+)      â”‚â”€â”€â”‚ (POS, etc)  â”‚â”€â”€â”‚ (6 ĞºĞ¾Ğ»ĞµĞºÑ†Ñ–Ğ¹)â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                          â”‚                                       â”‚
â”‚                          â–¼                                       â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚              â”‚     PostgreSQL      â”‚                            â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ñ„Ğ°Ğ¹Ğ»Ñ–Ğ²

### Frontend

```
frontend/
â”œâ”€â”€ app/
â”‚   â””â”€â”€ admin/
â”‚       â”œâ”€â”€ page.tsx              # Server Component - Ñ‚Ğ¾Ñ‡ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ñƒ
â”‚       â”œâ”€â”€ layout.tsx            # Auth Ğ¿ĞµÑ€ĞµĞ²Ñ–Ñ€ĞºĞ° + metadata
â”‚       â”œâ”€â”€ admin-client.tsx      # 656 Ñ€ÑĞ´ĞºÑ–Ğ² - Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ½Ğ¸Ğ¹ ĞºĞ»Ñ–Ñ”Ğ½Ñ‚
â”‚       â””â”€â”€ login/
â”‚           â””â”€â”€ page.tsx          # Ğ¤Ğ¾Ñ€Ğ¼Ğ° Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ñ–Ñ—
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ sections/
â”‚   â”‚   â”œâ”€â”€ pos-section.tsx       # 704 Ñ€ÑĞ´ĞºĞ¸ - POS Ñ‚ĞµÑ€Ğ¼Ñ–Ğ½Ğ°Ğ»
â”‚   â”‚   â”œâ”€â”€ products-section.tsx  # 1930 Ñ€ÑĞ´ĞºÑ–Ğ² - Ğ¢Ğ¾Ğ²Ğ°Ñ€Ğ¸
â”‚   â”‚   â”œâ”€â”€ clients-section.tsx   # 717 Ñ€ÑĞ´ĞºÑ–Ğ² - ĞšĞ»Ñ–Ñ”Ğ½Ñ‚Ğ¸
â”‚   â”‚   â”œâ”€â”€ analytics-section.tsx # 490 Ñ€ÑĞ´ĞºÑ–Ğ² - ĞĞ½Ğ°Ğ»Ñ–Ñ‚Ğ¸ĞºĞ°
â”‚   â”‚   â””â”€â”€ history-section.tsx   # 617 Ñ€ÑĞ´ĞºÑ–Ğ² - Ğ†ÑÑ‚Ğ¾Ñ€Ñ–Ñ Ğ·Ğ¼Ñ–Ğ½Ğ¸
â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â”œâ”€â”€ import-modal.tsx      # Excel Ñ–Ğ¼Ğ¿Ğ¾Ñ€Ñ‚
â”‚   â”‚   â”œâ”€â”€ planned-supply-modal.tsx
â”‚   â”‚   â”œâ”€â”€ modal.tsx
â”‚   â”‚   â””â”€â”€ alert-toast.tsx
â”‚   â””â”€â”€ layout/
â”‚       â”œâ”€â”€ sidebar.tsx
â”‚       â””â”€â”€ header.tsx
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ use-activity-log.ts       # 241 Ñ€ÑĞ´Ğ¾Ğº - Ğ†ÑÑ‚Ğ¾Ñ€Ñ–Ñ Ğ´Ñ–Ğ¹
â”‚   â”œâ”€â”€ use-alerts.ts             # Ğ¢Ğ¾ÑÑ‚ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ
â”‚   â”œâ”€â”€ use-customers.ts          # CRUD ĞºĞ»Ñ–Ñ”Ğ½Ñ‚Ñ–Ğ²
â”‚   â”œâ”€â”€ use-flowers.ts            # CRUD Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ–Ğ²
â”‚   â””â”€â”€ use-transactions.ts       # Ğ¢Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ñ–Ñ—
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ strapi.ts                 # 1172 Ñ€ÑĞ´ĞºĞ¸ - API Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ
â”‚   â”œâ”€â”€ types.ts                  # Ğ¢Ğ¸Ğ¿Ğ¸
â”‚   â”œâ”€â”€ api-types.ts              # API Ñ‚Ğ¸Ğ¿Ğ¸
â”‚   â”œâ”€â”€ auth.ts                   # JWT Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ñ–Ñ
â”‚   â”œâ”€â”€ graphql/
â”‚   â”‚   â”œâ”€â”€ client.ts             # GraphQL ĞºĞ»Ñ–Ñ”Ğ½Ñ‚
â”‚   â”‚   â”œâ”€â”€ queries.ts            # GraphQL Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ğ¸
â”‚   â”‚   â”œâ”€â”€ mutations.ts          # GraphQL Ğ¼ÑƒÑ‚Ğ°Ñ†Ñ–Ñ—
â”‚   â”‚   â””â”€â”€ types.ts              # GraphQL Ñ‚Ğ¸Ğ¿Ğ¸
â”‚   â””â”€â”€ export.ts                 # Excel ĞµĞºÑĞ¿Ğ¾Ñ€Ñ‚
```

### Backend (Strapi)

```
backend/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ api/
â”‚       â”œâ”€â”€ flower/               # Ğ¡Ñ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½Ğ¸Ğ¹ Strapi CRUD
â”‚       â”œâ”€â”€ variant/              # Ğ’Ğ°Ñ€Ñ–Ğ°Ğ½Ñ‚Ğ¸ ĞºĞ²Ñ–Ñ‚Ñ–Ğ²
â”‚       â”œâ”€â”€ customer/             # ĞšĞ»Ñ–Ñ”Ğ½Ñ‚Ğ¸
â”‚       â”œâ”€â”€ transaction/          # Ğ¢Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ñ–Ñ—
â”‚       â”œâ”€â”€ shift/                # Ğ Ğ¾Ğ±Ğ¾Ñ‡Ñ– Ğ·Ğ¼Ñ–Ğ½Ğ¸
â”‚       â”‚   â”œâ”€â”€ controllers/shift.ts  # 372 Ñ€ÑĞ´ĞºĞ¸
â”‚       â”‚   â””â”€â”€ routes/shift.ts
â”‚       â”œâ”€â”€ pos/                  # POS Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ñ–Ñ—
â”‚       â”‚   â”œâ”€â”€ controllers/pos.ts    # 356 Ñ€ÑĞ´ĞºÑ–Ğ²
â”‚       â”‚   â”œâ”€â”€ services/pos.ts       # 560 Ñ€ÑĞ´ĞºÑ–Ğ²
â”‚       â”‚   â””â”€â”€ routes/pos.ts
â”‚       â”œâ”€â”€ analytics/            # ĞĞ½Ğ°Ğ»Ñ–Ñ‚Ğ¸ĞºĞ°
â”‚       â”‚   â”œâ”€â”€ controllers/analytics.ts
â”‚       â”‚   â””â”€â”€ services/analytics.ts
â”‚       â”œâ”€â”€ import/               # Excel Ñ–Ğ¼Ğ¿Ğ¾Ñ€Ñ‚
â”‚       â”‚   â”œâ”€â”€ controllers/import.ts
â”‚       â”‚   â””â”€â”€ routes/import.ts
â”‚       â”œâ”€â”€ planned-supply/       # Ğ—Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¾Ğ²Ğ°Ğ½Ñ– Ğ¿Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ¸
â”‚       â””â”€â”€ auth/                 # ĞĞ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ñ–Ñ
â””â”€â”€ config/
    â”œâ”€â”€ database.ts
    â”œâ”€â”€ plugins.ts
    â””â”€â”€ middlewares.ts
```

---

## 3. ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¸ Ñ‚Ğ° ÑĞµĞºÑ†Ñ–Ñ—

### 3.1 AdminClient (admin-client.tsx)

**Ğ“Ğ¾Ğ»Ğ¾Ğ²Ğ½Ğ¸Ğ¹ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚** - Ğ¾Ñ€ĞºĞµÑÑ‚Ñ€ÑƒÑ” Ğ²ÑÑ– ÑĞµĞºÑ†Ñ–Ñ— Ñ‚Ğ° ÑÑ‚Ğ°Ğ½.

```typescript
// ĞÑĞ½Ğ¾Ğ²Ğ½Ñ– ÑÑ‚Ğ°Ğ½Ğ¸
const [products, setProducts] = useState<Product[]>(initialProducts);
const [customers, setCustomers] = useState<Customer[]>([]);
const [analyticsData, setAnalyticsData] = useState<DashboardData | null>(null);
const [cart, setCart] = useState<CartLine[]>([]);
const [selectedClient, setSelectedClient] = useState<string>();
const [isCheckingOut, setIsCheckingOut] = useState(false);
```

**ĞšĞ»ÑÑ‡Ğ¾Ğ²Ñ– Ñ„ÑƒĞ½ĞºÑ†Ñ–Ñ—:**

```typescript
// Ğ¡Ñ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ½Ñ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ñƒ - ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§ĞĞ ĞĞŸĞ•Ğ ĞĞ¦Ğ†Ğ¯
const handleCheckout = async () => {
  if (!selectedClient || cart.length === 0) {
    showError("ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°", "ĞĞ±ĞµÑ€Ñ–Ñ‚ÑŒ ĞºĞ»Ñ–Ñ”Ğ½Ñ‚Ğ° Ñ‚Ğ° Ğ´Ğ¾Ğ´Ğ°Ğ¹Ñ‚Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¸");
    return;
  }

  setIsCheckingOut(true);
  try {
    const operationId = generateOperationId(); // Ğ†Ğ´ĞµĞ¼Ğ¿Ğ¾Ñ‚ĞµĞ½Ñ‚Ğ½Ñ–ÑÑ‚ÑŒ
    const result = await createSale({
      operationId,
      customerId: selectedClient,
      items: cart.map((line) => ({
        flowerSlug: line.flowerSlug,
        length: line.length,
        qty: line.qty,
        price: line.price,
        name: line.name,
      })),
      discount,
      paymentStatus,
    });

    if (result.success) {
      // Ğ›Ğ¾Ğ³ÑƒÑ”Ğ¼Ğ¾ Ğ´Ğ»Ñ Ñ–ÑÑ‚Ğ¾Ñ€Ñ–Ñ— Ğ·Ğ¼Ñ–Ğ½Ğ¸
      logActivity('sale', { customerName, items, totalAmount, discount });

      showSuccess("Ğ—Ğ°Ğ¼Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ ÑÑ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ¾");
      setCart([]); // ĞÑ‡Ğ¸Ñ‰Ğ°Ñ”Ğ¼Ğ¾ ĞºĞ¾ÑˆĞ¸Ğº
      await refreshProducts(); // ĞĞ½Ğ¾Ğ²Ğ»ÑÑ”Ğ¼Ğ¾ ÑĞºĞ»Ğ°Ğ´
      await fetchCustomers(); // ĞĞ½Ğ¾Ğ²Ğ»ÑÑ”Ğ¼Ğ¾ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ ĞºĞ»Ñ–Ñ”Ğ½Ñ‚Ğ°
    } else {
      showError("ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°", result.error?.message);
    }
  } finally {
    setIsCheckingOut(false);
  }
};
```

### 3.2 PosSection (pos-section.tsx)

**POS Ñ‚ĞµÑ€Ğ¼Ñ–Ğ½Ğ°Ğ»** - ÑˆĞ²Ğ¸Ğ´ĞºĞµ Ğ¾Ñ„Ğ¾Ñ€Ğ¼Ğ»ĞµĞ½Ğ½Ñ Ğ·Ğ°Ğ¼Ğ¾Ğ²Ğ»ĞµĞ½ÑŒ.

**ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ– Ñ‚Ğ¾Ñ‡ĞºĞ¸:**

```typescript
// Ğ”Ğ¾Ğ´Ğ°Ğ²Ğ°Ğ½Ğ½Ñ Ğ´Ğ¾ ĞºĞ¾ÑˆĞ¸ĞºĞ°
const addToCart = (product: Product, variant: Variant) => {
  const id = `${product.id}-${variant.length}`;
  setCart((current) => {
    const existing = current.find((line) => line.id === id);
    if (existing) {
      // Ğ£Ğ’ĞĞ“Ğ: Ğ”Ğ¾Ğ´Ğ°Ñ”Ğ¼Ğ¾ Ñ„Ñ–ĞºÑĞ¾Ğ²Ğ°Ğ½Ğ¾ 25 ÑˆÑ‚ - Ğ½ĞµĞ¼Ğ°Ñ” Ğ¿ĞµÑ€ĞµĞ²Ñ–Ñ€ĞºĞ¸ Ğ½Ğ° stock!
      return current.map((line) =>
        line.id === id ? { ...line, qty: line.qty + 25 } : line
      );
    }
    return [...current, {
      id,
      flowerSlug: product.id, // product.id = slug
      length: variant.length,
      qty: 25, // Ğ¤Ñ–ĞºÑĞ¾Ğ²Ğ°Ğ½Ğ° ĞºÑ–Ğ»ÑŒĞºÑ–ÑÑ‚ÑŒ
      price: variant.price,
      name: product.name,
    }];
  });
};
```

**ĞŸĞ¾Ñ‚ĞµĞ½Ñ†Ñ–Ğ¹Ğ½Ğ° Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** ĞĞµĞ¼Ğ°Ñ” ĞºĞ»Ñ–Ñ”Ğ½Ñ‚ÑÑŒĞºĞ¾Ñ— Ğ¿ĞµÑ€ĞµĞ²Ñ–Ñ€ĞºĞ¸ stock Ğ¿Ñ€Ğ¸ Ğ´Ğ¾Ğ´Ğ°Ğ²Ğ°Ğ½Ğ½Ñ– Ğ´Ğ¾ ĞºĞ¾ÑˆĞ¸ĞºĞ°. ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€ĞºĞ° Ğ²Ñ–Ğ´Ğ±ÑƒĞ²Ğ°Ñ”Ñ‚ÑŒÑÑ Ñ‚Ñ–Ğ»ÑŒĞºĞ¸ Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ñ– Ğ¿Ñ€Ğ¸ checkout.

### 3.3 ProductsSection (products-section.tsx)

**ĞĞ°Ğ¹Ğ±Ñ–Ğ»ÑŒÑˆĞ¸Ğ¹ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚** - ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»Ñ–Ğ½Ğ½Ñ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°Ğ¼Ğ¸.

**Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° ÑÑ‚Ğ°Ğ½Ñ–Ğ²:**

```typescript
// ĞÑĞ½Ğ¾Ğ²Ğ½Ñ– ÑÑ‚Ğ°Ğ½Ğ¸
const [open, setOpen] = useState(false);           // ĞœĞ¾Ğ´Ğ°Ğ»ĞºĞ° Ğ´Ğ¾Ğ´Ğ°Ğ²Ğ°Ğ½Ğ½Ñ
const [draft, setDraft] = useState<{...}>();       // Ğ§ĞµÑ€Ğ½ĞµÑ‚ĞºĞ° Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñƒ
const [editModalOpen, setEditModalOpen] = useState(false);
const [editingProduct, setEditingProduct] = useState<Product | null>(null);
const [editData, setEditData] = useState<{
  image: File | null;
  imagePreview: string | null;
  description: string;
  variants: Array<{
    documentId: string;
    length: number;
    price: number;
    stock: number;
    isNew?: boolean;
    isDeleted?: boolean;  // Ğ”Ğ»Ñ Ğ²Ğ¸Ğ´Ğ°Ğ»ĞµĞ½Ğ½Ñ Ğ²Ğ°Ñ€Ñ–Ğ°Ğ½Ñ‚Ñ–Ğ²
  }>;
  originalVariants: Array<{...}>;  // Ğ”Ğ»Ñ Ğ¿Ğ¾Ñ€Ñ–Ğ²Ğ½ÑĞ½Ğ½Ñ Ğ·Ğ¼Ñ–Ğ½
}>();
```

**ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ° Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ñ–Ñ - Ğ·Ğ±ĞµÑ€ĞµĞ¶ĞµĞ½Ğ½Ñ Ñ€ĞµĞ´Ğ°Ğ³ÑƒĞ²Ğ°Ğ½Ğ½Ñ:**

```typescript
const handleSaveEdit = async () => {
  // 1. Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ñ
  let imageId: number | null = null;
  if (editData.image) {
    const uploadResponse = await fetch(`${STRAPI_URL}/api/upload`, {
      method: "POST",
      headers: uploadHeaders,
      body: imageFormData,
    });
    // Ğ¯ĞºÑ‰Ğ¾ Ğ¿Ğ¾Ğ¼Ğ¸Ğ»ĞºĞ° - Ğ·Ğ°Ğ¿Ğ¸Ñ‚ÑƒÑ”Ğ¼Ğ¾ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ° Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ²Ğ¶Ğ¸Ñ‚Ğ¸ Ğ±ĞµĞ· Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ½Ñ
  }

  // 2. ĞĞ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ ĞºĞ²Ñ–Ñ‚ĞºĞ¸
  await updateFlower(editingProduct.documentId, {
    description: descriptionBlocks,
    imageId,
  });

  // 3. Ğ’Ğ¸Ğ´Ğ°Ğ»ĞµĞ½Ğ½Ñ Ğ¿Ğ¾Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ… Ğ²Ğ°Ñ€Ñ–Ğ°Ğ½Ñ‚Ñ–Ğ²
  for (const variant of deletedVariants) {
    await fetch(`${STRAPI_URL}/api/variants/${variant.documentId}`, {
      method: "DELETE",
    });
    // Ğ›Ğ¾Ğ³ÑƒÑ”Ğ¼Ğ¾ Ğ²Ğ¸Ğ´Ğ°Ğ»ĞµĞ½Ğ½Ñ
    onLogActivity('variantDelete', {
      productName: editingProduct.name,
      variantLength: variant.length,
      variantPrice: variant.price,
      variantStock: variant.stock,
    });
  }

  // 4. ĞĞ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ/ÑÑ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ½Ñ Ğ²Ğ°Ñ€Ñ–Ğ°Ğ½Ñ‚Ñ–Ğ²
  for (const variant of activeVariants) {
    if (variant.isNew) {
      // Ğ¡Ñ‚Ğ²Ğ¾Ñ€ÑÑ”Ğ¼Ğ¾ Ğ½Ğ¾Ğ²Ğ¸Ğ¹
      await fetch(`${STRAPI_URL}/api/variants`, {
        method: "POST",
        body: JSON.stringify({
          data: {
            length: variant.length,
            price: variant.price,
            stock: variant.stock,
            flower: { connect: [{ documentId: editingProduct.documentId }] },
          },
        }),
      });
    } else {
      // ĞĞ½Ğ¾Ğ²Ğ»ÑÑ”Ğ¼Ğ¾ Ñ–ÑĞ½ÑƒÑÑ‡Ğ¸Ğ¹
      await updateVariant(variant.documentId, {
        price: variant.price,
        stock: variant.stock,
      });
    }
  }
};
```

**ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§ĞĞ˜Ğ™ Ğ Ğ˜Ğ—Ğ˜Ğš:** ĞĞ¿ĞµÑ€Ğ°Ñ†Ñ–Ñ— Ğ½Ğµ Ğ°Ñ‚Ğ¾Ğ¼Ğ°Ñ€Ğ½Ñ–! Ğ¯ĞºÑ‰Ğ¾ Ğ²Ğ¸Ğ´Ğ°Ğ»ĞµĞ½Ğ½Ñ Ğ²Ğ°Ñ€Ñ–Ğ°Ğ½Ñ‚Ğ° ÑƒÑĞ¿Ñ–ÑˆĞ½Ğµ, Ğ°Ğ»Ğµ Ğ¾Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ Ñ–Ğ½ÑˆĞ¾Ğ³Ğ¾ - Ñ‡Ğ°ÑÑ‚ĞºĞ¾Ğ²Ñ– Ğ·Ğ¼Ñ–Ğ½Ğ¸.

### 3.4 ClientsSection (clients-section.tsx)

**Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»Ñ–Ğ½Ğ½Ñ ĞºĞ»Ñ–Ñ”Ğ½Ñ‚Ğ°Ğ¼Ğ¸.**

```typescript
// Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ñ–Ğ¹ Ğ´Ğ»Ñ Ğ’Ğ¡Ğ†Ğ¥ ĞºĞ»Ñ–Ñ”Ğ½Ñ‚Ñ–Ğ² Ğ¿Ñ€Ğ¸ Ğ¼Ğ¾Ğ½Ñ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ–
useEffect(() => {
  const loadTransactionsForAll = async () => {
    const transactionPromises = customers.map(async (customer) => {
      const result = await getTransactions({
        customerId: customer.documentId,
        type: 'sale',
        limit: 100,
      });
      // ĞĞ±Ñ‡Ğ¸ÑĞ»ÑÑ”Ğ¼Ğ¾ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñƒ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºÑƒ Ğ· Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ñ–Ğ¹
      return {
        customerId: customer.documentId,
        orders: result.data.length,
        spent: result.data.reduce((sum, t) => sum + t.amount, 0),
      };
    });
    await Promise.all(transactionPromises);
  };
  loadTransactionsForAll();
}, [customers]);
```

**ĞŸĞ¾Ñ‚ĞµĞ½Ñ†Ñ–Ğ¹Ğ½Ğ° Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** ĞŸÑ€Ğ¸ Ğ²ĞµĞ»Ğ¸ĞºÑ–Ğ¹ ĞºÑ–Ğ»ÑŒĞºĞ¾ÑÑ‚Ñ– ĞºĞ»Ñ–Ñ”Ğ½Ñ‚Ñ–Ğ² - Ğ±Ğ°Ğ³Ğ°Ñ‚Ğ¾ Ğ¿Ğ°Ñ€Ğ°Ğ»ĞµĞ»ÑŒĞ½Ğ¸Ñ… Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ñ–Ğ². ĞœĞ¾Ğ¶Ğµ Ğ¿Ñ€Ğ¸Ğ·Ğ²ĞµÑÑ‚Ğ¸ Ğ´Ğ¾ rate limiting.

### 3.5 HistorySection (history-section.tsx)

**Ğ†ÑÑ‚Ğ¾Ñ€Ñ–Ñ Ñ€Ğ¾Ğ±Ğ¾Ñ‡Ğ¾Ñ— Ğ·Ğ¼Ñ–Ğ½Ğ¸** Ğ· ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ñ–Ğ·Ğ°Ñ†Ñ–Ñ”Ñ Ğ¼Ñ–Ğ¶ Ğ¿Ñ€Ğ¸ÑÑ‚Ñ€Ğ¾ÑĞ¼Ğ¸.

```typescript
// Polling ĞºĞ¾Ğ¶Ğ½Ñ– 30 ÑĞµĞºÑƒĞ½Ğ´ Ğ´Ğ»Ñ multi-device sync
const POLL_INTERVAL = 30000;

useEffect(() => {
  pollIntervalRef.current = setInterval(() => {
    fetchCurrentShift();
  }, POLL_INTERVAL);
  return () => clearInterval(pollIntervalRef.current);
}, []);
```

---

## 4. API Ñ‚Ğ° Ğ¿Ğ¾Ñ‚Ñ–Ğº Ğ´Ğ°Ğ½Ğ¸Ñ…

### 4.1 GraphQL Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ğ¸ (lib/graphql/queries.ts)

```graphql
# ĞÑ‚Ñ€Ğ¸Ğ¼Ğ°Ğ½Ğ½Ñ ĞºĞ²Ñ–Ñ‚Ñ–Ğ² Ğ· Ğ²Ğ°Ñ€Ñ–Ğ°Ğ½Ñ‚Ğ°Ğ¼Ğ¸
query GetFlowers($pageSize: Int = 100) {
  flowers(
    pagination: { pageSize: $pageSize }
    filters: { publishedAt: { notNull: true } }
  ) {
    documentId
    name
    slug
    description
    publishedAt
    updatedAt
    image {
      documentId
      url
      formats
    }
    variants {
      documentId
      length
      price
      stock
    }
  }
}
```

### 4.2 REST API ĞµĞ½Ğ´Ğ¿Ğ¾Ñ–Ğ½Ñ‚Ğ¸

| Ğ•Ğ½Ğ´Ğ¿Ğ¾Ñ–Ğ½Ñ‚ | ĞœĞµÑ‚Ğ¾Ğ´ | ĞĞ¿Ğ¸Ñ | Ğ—Ğ°Ñ…Ğ¸ÑÑ‚ |
|----------|-------|------|--------|
| `/api/pos/sales` | POST | Ğ¡Ñ‚Ğ²Ğ¾Ñ€Ğ¸Ñ‚Ğ¸ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶ | ĞŸÑƒĞ±Ğ»Ñ–Ñ‡Ğ½Ğ¸Ğ¹ |
| `/api/pos/write-offs` | POST | Ğ¡Ğ¿Ğ¸ÑĞ°Ğ½Ğ½Ñ | ĞŸÑƒĞ±Ğ»Ñ–Ñ‡Ğ½Ğ¸Ğ¹ |
| `/api/pos/transactions/:id/confirm-payment` | PUT | ĞŸÑ–Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚Ğ¸ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñƒ | ĞŸÑƒĞ±Ğ»Ñ–Ñ‡Ğ½Ğ¸Ğ¹ |
| `/api/shifts/current` | GET | ĞŸĞ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ° Ğ·Ğ¼Ñ–Ğ½Ğ° | ĞŸÑƒĞ±Ğ»Ñ–Ñ‡Ğ½Ğ¸Ğ¹ |
| `/api/shifts/current/activity` | POST | Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ Ğ´Ñ–Ñ | Auth |
| `/api/shifts/close` | POST | Ğ—Ğ°ĞºÑ€Ğ¸Ñ‚Ğ¸ Ğ·Ğ¼Ñ–Ğ½Ñƒ | Auth |
| `/api/analytics/dashboard` | GET | ĞĞ½Ğ°Ğ»Ñ–Ñ‚Ğ¸ĞºĞ° | ĞŸÑƒĞ±Ğ»Ñ–Ñ‡Ğ½Ğ¸Ğ¹ |
| `/api/imports/excel` | POST | Ğ†Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ Excel | Auth |
| `/api/planned-supply/low-stock` | GET | ĞĞ¸Ğ·ÑŒĞºÑ– Ğ·Ğ°Ğ»Ğ¸ÑˆĞºĞ¸ | ĞŸÑƒĞ±Ğ»Ñ–Ñ‡Ğ½Ğ¸Ğ¹ |

### 4.3 ĞŸĞ¾Ñ‚Ñ–Ğº Ğ´Ğ°Ğ½Ğ¸Ñ… Ğ¿Ñ€Ğ¸ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ñƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. ĞšĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡ Ğ½Ğ°Ñ‚Ğ¸ÑĞºĞ°Ñ” "ĞÑ„Ğ¾Ñ€Ğ¼Ğ¸Ñ‚Ğ¸ Ğ·Ğ°Ğ¼Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ"                   â”‚
â”‚  2. handleCheckout() Ğ² admin-client.tsx                         â”‚
â”‚  3. generateOperationId() - ÑƒĞ½Ñ–ĞºĞ°Ğ»ÑŒĞ½Ğ¸Ğ¹ ID Ğ´Ğ»Ñ Ñ–Ğ´ĞµĞ¼Ğ¿Ğ¾Ñ‚ĞµĞ½Ñ‚Ğ½Ğ¾ÑÑ‚Ñ–   â”‚
â”‚  4. createSale() Ğ² lib/strapi.ts                                â”‚
â”‚                          â”‚                                       â”‚
â”‚                          â–¼                                       â”‚
â”‚         POST /api/pos/sales                                     â”‚
â”‚         {                                                        â”‚
â”‚           operationId: "550e8400-e29b-...",                     â”‚
â”‚           customerId: "abc123",                                  â”‚
â”‚           items: [...],                                          â”‚
â”‚           discount: 0,                                           â”‚
â”‚           paymentStatus: "expected"                              â”‚
â”‚         }                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          â–¼                                       â”‚
â”‚                    BACKEND (Strapi)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  POS Controller (pos.ts:67)                                     â”‚
â”‚  â”‚                                                               â”‚
â”‚  â”œâ”€â”€ 1. Ğ’Ğ°Ğ»Ñ–Ğ´Ğ°Ñ†Ñ–Ñ Ğ²Ñ…Ñ–Ğ´Ğ½Ğ¸Ñ… Ğ´Ğ°Ğ½Ğ¸Ñ…                                 â”‚
â”‚  â”‚   - operationId required                                      â”‚
â”‚  â”‚   - customerId required                                       â”‚
â”‚  â”‚   - items[] not empty                                         â”‚
â”‚  â”‚   - each item has flowerSlug, length, qty, price, name       â”‚
â”‚  â”‚                                                               â”‚
â”‚  â””â”€â”€ 2. Ğ’Ğ¸ĞºĞ»Ğ¸Ğº POS Service                                      â”‚
â”‚                                                                  â”‚
â”‚  POS Service (pos.ts:195)                                       â”‚
â”‚  â”‚                                                               â”‚
â”‚  â”œâ”€â”€ 1. ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€ĞºĞ° Ñ–Ğ´ĞµĞ¼Ğ¿Ğ¾Ñ‚ĞµĞ½Ñ‚Ğ½Ğ¾ÑÑ‚Ñ–                               â”‚
â”‚  â”‚   SELECT * FROM transactions WHERE operationId = ?            â”‚
â”‚  â”‚   Ğ¯ĞºÑ‰Ğ¾ Ñ–ÑĞ½ÑƒÑ” â†’ return { success: true, idempotent: true }    â”‚
â”‚  â”‚                                                               â”‚
â”‚  â”œâ”€â”€ 2. ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€ĞºĞ° ĞºĞ»Ñ–Ñ”Ğ½Ñ‚Ğ°                                       â”‚
â”‚  â”‚   SELECT * FROM customers WHERE documentId = ?                â”‚
â”‚  â”‚                                                               â”‚
â”‚  â”œâ”€â”€ 3. Ğ’Ğ°Ğ»Ñ–Ğ´Ğ°Ñ†Ñ–Ñ stock Ğ´Ğ»Ñ ĞºĞ¾Ğ¶Ğ½Ğ¾Ğ³Ğ¾ item                        â”‚
â”‚  â”‚   FOR EACH item:                                              â”‚
â”‚  â”‚     SELECT * FROM variants                                    â”‚
â”‚  â”‚     WHERE flower.slug = ? AND length = ?                      â”‚
â”‚  â”‚     IF stock < qty â†’ ERROR                                    â”‚
â”‚  â”‚                                                               â”‚
â”‚  â”œâ”€â”€ 4. ĞĞ¢ĞĞœĞĞ ĞĞ† ĞĞŸĞ•Ğ ĞĞ¦Ğ†Ğ‡ (Ğ¿Ğ¾ÑĞ»Ñ–Ğ´Ğ¾Ğ²Ğ½Ğ¾, Ğ±ĞµĞ· Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ñ–Ñ—!)        â”‚
â”‚  â”‚   â”‚                                                           â”‚
â”‚  â”‚   â”œâ”€â”€ 4a. Ğ”ĞµĞºÑ€ĞµĞ¼ĞµĞ½Ñ‚ stock                                    â”‚
â”‚  â”‚   â”‚   FOR EACH item:                                          â”‚
â”‚  â”‚   â”‚     UPDATE variants SET stock = stock - qty               â”‚
â”‚  â”‚   â”‚                                                           â”‚
â”‚  â”‚   â”œâ”€â”€ 4b. Ğ¡Ñ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ½Ñ Transaction                              â”‚
â”‚  â”‚   â”‚   INSERT INTO transactions (...)                          â”‚
â”‚  â”‚   â”‚                                                           â”‚
â”‚  â”‚   â””â”€â”€ 4c. ĞĞ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ ĞºĞ»Ñ–Ñ”Ğ½Ñ‚Ğ° (ÑĞºÑ‰Ğ¾ paid)           â”‚
â”‚  â”‚       UPDATE customers SET orderCount++, totalSpent+=         â”‚
â”‚  â”‚                                                               â”‚
â”‚  â””â”€â”€ 5. Return result                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          â–¼                                       â”‚
â”‚                    FRONTEND (Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ²Ğ¶ĞµĞ½Ğ½Ñ)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  5. ĞĞ±Ñ€Ğ¾Ğ±ĞºĞ° Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´Ñ–                                           â”‚
â”‚  6. logActivity('sale', {...}) - Ğ·Ğ°Ğ¿Ğ¸Ñ Ğ² Ñ–ÑÑ‚Ğ¾Ñ€Ñ–Ñ Ğ·Ğ¼Ñ–Ğ½Ğ¸          â”‚
â”‚  7. showSuccess() - Ñ‚Ğ¾ÑÑ‚ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ                           â”‚
â”‚  8. setCart([]) - Ğ¾Ñ‡Ğ¸Ñ‰ĞµĞ½Ğ½Ñ ĞºĞ¾ÑˆĞ¸ĞºĞ°                               â”‚
â”‚  9. refreshProducts() - Ğ¾Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ stock                         â”‚
â”‚  10. fetchCustomers() - Ğ¾Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ ĞºĞ»Ñ–Ñ”Ğ½Ñ‚Ğ°            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ– Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ğ¾Ğ±Ñ€Ğ¾Ğ±ĞºĞ¸ Ğ´Ğ°Ğ½Ğ¸Ñ…

### 5.1 Ğ¡Ñ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ½Ñ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ñƒ (POS Service)

**Ğ¤Ğ°Ğ¹Ğ»:** `backend/src/api/pos/services/pos.ts:195-340`

```typescript
async createSale(data: CreateSaleInput) {
  // ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§ĞĞ Ğ¢ĞĞ§ĞšĞ 1: Ğ†Ğ´ĞµĞ¼Ğ¿Ğ¾Ñ‚ĞµĞ½Ñ‚Ğ½Ñ–ÑÑ‚ÑŒ
  const existing = await this.findByOperationId(data.operationId);
  if (existing) {
    return { success: true, idempotent: true, data: existing };
  }

  // ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§ĞĞ Ğ¢ĞĞ§ĞšĞ 2: ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€ĞºĞ° ĞºĞ»Ñ–Ñ”Ğ½Ñ‚Ğ°
  const customer = await strapi.db.query('api::customer.customer').findOne({
    where: { documentId: data.customerId },
  });
  if (!customer) {
    return { success: false, error: { code: 'CUSTOMER_NOT_FOUND' } };
  }

  // ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§ĞĞ Ğ¢ĞĞ§ĞšĞ 3: Ğ’Ğ°Ğ»Ñ–Ğ´Ğ°Ñ†Ñ–Ñ stock
  const { valid, errors, variants } = await this.validateStock(data.items);
  if (!valid) {
    return {
      success: false,
      error: {
        code: 'INSUFFICIENT_STOCK',
        details: errors, // ĞœĞ°ÑĞ¸Ğ² Ğ· Ğ´ĞµÑ‚Ğ°Ğ»ÑĞ¼Ğ¸ Ğ¿Ğ¾ ĞºĞ¾Ğ¶Ğ½Ğ¾Ğ¼Ñƒ item
      },
    };
  }

  // ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§ĞĞ Ğ¢ĞĞ§ĞšĞ 4: ĞĞ¿ĞµÑ€Ğ°Ñ†Ñ–Ñ— Ğ· Ğ‘Ğ” (ĞĞ• ĞĞ¢ĞĞœĞĞ ĞĞ†!)
  try {
    // 4a. Ğ”ĞµĞºÑ€ĞµĞ¼ĞµĞ½Ñ‚ stock
    for (const item of data.items) {
      const variant = variants.get(`${item.flowerSlug}-${item.length}`);
      await strapi.db.query('api::variant.variant').update({
        where: { documentId: variant.documentId },
        data: { stock: variant.stock - item.qty },
      });
    }

    // 4b. Ğ¡Ñ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ½Ñ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ñ–Ñ—
    const transaction = await strapi.db.query('api::transaction.transaction').create({
      data: {
        date: new Date().toISOString(),
        type: 'sale',
        operationId: data.operationId,
        paymentStatus: data.paymentStatus || 'pending',
        amount,
        items: data.items,
        customer: customer.id,
      },
    });

    // 4c. ĞĞ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ ĞºĞ»Ñ–Ñ”Ğ½Ñ‚Ğ°
    if (data.paymentStatus === 'paid') {
      await strapi.db.query('api::customer.customer').update({
        where: { documentId: customer.documentId },
        data: {
          orderCount: (customer.orderCount || 0) + 1,
          totalSpent: (customer.totalSpent || 0) + amount,
        },
      });
    }

    return { success: true, data: transaction };
  } catch (error) {
    // âš ï¸ Ğ Ğ˜Ğ—Ğ˜Ğš: Ğ¯ĞºÑ‰Ğ¾ Ğ¿Ğ¾Ğ¼Ğ¸Ğ»ĞºĞ° Ğ¿Ñ–ÑĞ»Ñ Ğ´ĞµĞºÑ€ĞµĞ¼ĞµĞ½Ñ‚Ñƒ stock - rollback Ğ²Ñ–Ğ´ÑÑƒÑ‚Ğ½Ñ–Ğ¹!
    strapi.log.error('Sale creation error:', error);
    return { success: false, error: { code: 'INTERNAL_ERROR' } };
  }
}
```

### 5.2 Ğ¡Ğ¿Ğ¸ÑĞ°Ğ½Ğ½Ñ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñƒ

**Ğ¤Ğ°Ğ¹Ğ»:** `backend/src/api/pos/services/pos.ts:345-473`

```typescript
async createWriteOff(data: CreateWriteOffInput) {
  // Ğ†Ğ´ĞµĞ¼Ğ¿Ğ¾Ñ‚ĞµĞ½Ñ‚Ğ½Ñ–ÑÑ‚ÑŒ
  const existing = await this.findByOperationId(data.operationId);
  if (existing) return { success: true, idempotent: true };

  // ĞŸĞ¾ÑˆÑƒĞº Ğ²Ğ°Ñ€Ñ–Ğ°Ğ½Ñ‚Ğ°
  const variant = await this.findVariant(data.flowerSlug, data.length);
  if (!variant) {
    return { success: false, error: { code: 'VARIANT_NOT_FOUND' } };
  }

  // ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€ĞºĞ° stock
  if (variant.stock < data.qty) {
    return {
      success: false,
      error: {
        code: 'INSUFFICIENT_STOCK',
        message: `Cannot write off ${data.qty}. Only ${variant.stock} available.`,
      },
    };
  }

  // ĞĞ¿ĞµÑ€Ğ°Ñ†Ñ–Ñ—
  await strapi.db.query('api::variant.variant').update({
    where: { documentId: variant.documentId },
    data: { stock: variant.stock - data.qty },
  });

  const transaction = await strapi.db.query('api::transaction.transaction').create({
    data: {
      type: 'writeOff',
      operationId: data.operationId,
      paymentStatus: 'cancelled',
      amount: 0,
      items: [{
        flowerSlug: data.flowerSlug,
        length: data.length,
        qty: data.qty,
        price: variant.price,
        name: variant.flower?.name,
      }],
      writeOffReason: data.reason,
    },
  });

  return { success: true, data: transaction };
}
```

### 5.3 Excel Ñ–Ğ¼Ğ¿Ğ¾Ñ€Ñ‚

**Ğ¤Ğ°Ğ¹Ğ»:** `frontend/components/ui/import-modal.tsx`

```typescript
// ĞĞ¿Ñ†Ñ–Ñ— Ñ–Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ñƒ
const [options, setOptions] = useState<ImportOptions>({
  dryRun: true,           // Ğ¢ĞµÑÑ‚Ğ¾Ğ²Ğ¸Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼ Ğ·Ğ° Ğ·Ğ°Ğ¼Ğ¾Ğ²Ñ‡ÑƒĞ²Ğ°Ğ½Ğ½ÑĞ¼
  stockMode: "add",       // Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ Ğ´Ğ¾ Ñ–ÑĞ½ÑƒÑÑ‡Ğ¾Ğ³Ğ¾ stock
  priceMode: "skip",      // Ğ—Ğ°Ğ»Ğ¸ÑˆĞ¸Ñ‚Ğ¸ ÑÑ‚Ğ°Ñ€Ñƒ Ñ†Ñ–Ğ½Ñƒ
});

// ĞŸÑ€Ğ¾Ñ†ĞµÑ Ñ–Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ñƒ
const handleImport = async () => {
  const result = await importExcel(selectedFile, {
    ...options,
    awb: awb || undefined,
    supplier: supplier || undefined,
    forceImport: checksum ? true : undefined,  // ĞĞ±Ñ…Ñ–Ğ´ Ğ´ÑƒĞ±Ğ»Ñ–ĞºĞ°Ñ‚Ñƒ
  });

  if (result.success) {
    // ĞŸĞ¾ĞºĞ°Ğ·ÑƒÑ”Ğ¼Ğ¾ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¸
    // flowers_created, flowers_updated, variants_created, etc.
  }
};
```

**Backend Ğ²Ğ°Ğ»Ñ–Ğ´Ğ°Ñ†Ñ–Ñ:**
- ĞĞ¾Ñ€Ğ¼Ğ°Ğ»Ñ–Ğ·Ğ°Ñ†Ñ–Ñ Ğ½Ğ°Ğ·Ğ² ĞºĞ²Ñ–Ñ‚Ñ–Ğ² (Freedom Rose â†’ Freedom)
- Checksum Ğ´Ğ»Ñ Ğ·Ğ°Ğ¿Ğ¾Ğ±Ñ–Ğ³Ğ°Ğ½Ğ½Ñ Ğ´ÑƒĞ±Ğ»Ñ–ĞºĞ°Ñ‚Ñ–Ğ²
- Ğ›Ğ¾Ğ³ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ğ²ÑÑ–Ñ… Ğ·Ğ¼Ñ–Ğ½

### 5.4 Ğ ĞµĞ´Ğ°Ğ³ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ğ²Ğ°Ñ€Ñ–Ğ°Ğ½Ñ‚Ñ–Ğ²

**Ğ¤Ğ°Ğ¹Ğ»:** `frontend/components/sections/products-section.tsx:389-583`

```typescript
// Ğ’Ğ¸Ğ´Ğ°Ğ»ĞµĞ½Ğ½Ñ Ğ²Ğ°Ñ€Ñ–Ğ°Ğ½Ñ‚Ğ° (Ğ¿Ğ¾Ğ·Ğ½Ğ°Ñ‡ĞºĞ°, Ğ½Ğµ Ñ„Ğ°ĞºÑ‚Ğ¸Ñ‡Ğ½Ğµ Ğ²Ğ¸Ğ´Ğ°Ğ»ĞµĞ½Ğ½Ñ)
const removeEditVariant = (documentId: string) => {
  setEditData((prev) => {
    const variant = prev.variants.find(v => v.documentId === documentId);
    if (variant?.isNew) {
      // ĞĞ¾Ğ²Ğ¸Ğ¹ Ğ²Ğ°Ñ€Ñ–Ğ°Ğ½Ñ‚ - Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ²Ğ¸Ğ´Ğ°Ğ»ÑÑ”Ğ¼Ğ¾
      return {
        ...prev,
        variants: prev.variants.filter((v) => v.documentId !== documentId),
      };
    }
    // Ğ†ÑĞ½ÑƒÑÑ‡Ğ¸Ğ¹ - Ğ¿Ğ¾Ğ·Ğ½Ğ°Ñ‡Ğ°Ñ”Ğ¼Ğ¾ ÑĞº Ğ²Ğ¸Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğ¹
    return {
      ...prev,
      variants: prev.variants.map((v) =>
        v.documentId === documentId ? { ...v, isDeleted: true } : v
      ),
    };
  });
};

// Ğ—Ğ±ĞµÑ€ĞµĞ¶ĞµĞ½Ğ½Ñ - Ğ¿Ğ¾ÑĞ»Ñ–Ğ´Ğ¾Ğ²Ğ½Ñ– Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ñ–Ñ—
const handleSaveEdit = async () => {
  // ... upload image ...
  // ... update flower ...

  // Ğ’Ğ¸Ğ´Ğ°Ğ»ĞµĞ½Ğ½Ñ Ğ¿Ğ¾Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ… Ğ²Ğ°Ñ€Ñ–Ğ°Ğ½Ñ‚Ñ–Ğ²
  const deletedVariants = editData.variants.filter(v => v.isDeleted && !v.isNew);
  for (const variant of deletedVariants) {
    const deleteResponse = await fetch(
      `${STRAPI_URL}/api/variants/${variant.documentId}`,
      { method: "DELETE", headers: authHeaders }
    );

    if (deleteResponse.ok && onLogActivity) {
      onLogActivity('variantDelete', {
        productName: editingProduct.name,
        variantLength: variant.length,
        variantPrice: variant.price,
        variantStock: variant.stock,
      });
    }
  }
  // ... update/create variants ...
};
```

---

## 6. ĞŸĞ¾Ñ‚ĞµĞ½Ñ†Ñ–Ğ¹Ğ½Ñ– Ğ¿Ğ¾Ğ¼Ğ¸Ğ»ĞºĞ¸ Ñ‚Ğ° Ñ€Ğ¸Ğ·Ğ¸ĞºĞ¸

### 6.1 ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§ĞĞ† (Ğ¼Ğ¾Ğ¶ÑƒÑ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ·Ğ²ĞµÑÑ‚Ğ¸ Ğ´Ğ¾ Ğ²Ñ‚Ñ€Ğ°Ñ‚Ğ¸ Ğ´Ğ°Ğ½Ğ¸Ñ…)

| # | ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° | ĞœÑ–ÑÑ†Ğµ | Ğ’Ğ¿Ğ»Ğ¸Ğ² | Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ñ–Ñ |
|---|----------|-------|-------|--------------|
| 1 | **Ğ’Ñ–Ğ´ÑÑƒÑ‚Ğ½Ñ–ÑÑ‚ÑŒ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ñ–Ğ¹ Ğ‘Ğ”** | POS Service | Ğ§Ğ°ÑÑ‚ĞºĞ¾Ğ²Ğµ Ğ¾Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ¼Ğ¸Ğ»Ñ†Ñ– | Ğ’Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ´Ğ¸Ñ‚Ğ¸ database transactions |
| 2 | **Race condition Ğ¿Ñ€Ğ¸ checkout** | POS Service | ĞŸÑ€Ğ¾Ğ´Ğ°Ğ¶ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñƒ Ğ· Ğ½ĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ½Ñ–Ğ¼ stock | ĞĞ¿Ñ‚Ğ¸Ğ¼Ñ–ÑÑ‚Ğ¸Ñ‡Ğ½Ğµ Ğ±Ğ»Ğ¾ĞºÑƒĞ²Ğ°Ğ½Ğ½Ñ Ğ°Ğ±Ğ¾ SELECT FOR UPDATE |
| 3 | **ĞĞµĞ¿Ğ¾Ğ²Ğ½Ğµ Ğ²Ğ¸Ğ´Ğ°Ğ»ĞµĞ½Ğ½Ñ Ğ²Ğ°Ñ€Ñ–Ğ°Ğ½Ñ‚Ñ–Ğ²** | products-section.tsx | Orphan Ğ²Ğ°Ñ€Ñ–Ğ°Ğ½Ñ‚Ğ¸ | ĞšĞ°ÑĞºĞ°Ğ´Ğ½Ğµ Ğ²Ğ¸Ğ´Ğ°Ğ»ĞµĞ½Ğ½Ñ Ñ‡ĞµÑ€ĞµĞ· Strapi relations |
| 4 | **Ğ’Ñ‚Ñ€Ğ°Ñ‚Ğ° Ğ´Ğ°Ğ½Ğ¸Ñ… Ğ¿Ñ€Ğ¸ Ğ·Ğ°ĞºÑ€Ğ¸Ñ‚Ñ‚Ñ– Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ°** | import-modal.tsx | Ğ’Ñ‚Ñ€Ğ°Ñ‚Ğ° Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑƒ Ñ–Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ñƒ | Server-side sessions Ğ´Ğ»Ñ Ñ–Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ñƒ |

### 6.2 Ğ’Ğ˜Ğ¡ĞĞšĞ˜Ğ™ ĞŸĞ Ğ†ĞĞ Ğ˜Ğ¢Ğ•Ğ¢

| # | ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° | ĞœÑ–ÑÑ†Ğµ | Ğ’Ğ¿Ğ»Ğ¸Ğ² |
|---|----------|-------|-------|
| 5 | ĞĞµĞ¼Ğ°Ñ” Ğ¿ĞµÑ€ĞµĞ²Ñ–Ñ€ĞºĞ¸ stock Ğ¿Ñ€Ğ¸ addToCart | pos-section.tsx | UX - Ğ¿Ğ¾Ğ¼Ğ¸Ğ»ĞºĞ° Ñ‚Ñ–Ğ»ÑŒĞºĞ¸ Ğ¿Ñ€Ğ¸ checkout |
| 6 | ĞŸĞ°Ñ€Ğ°Ğ»ĞµĞ»ÑŒĞ½Ñ– Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ğ¸ Ğ´Ğ»Ñ Ğ²ÑÑ–Ñ… ĞºĞ»Ñ–Ñ”Ğ½Ñ‚Ñ–Ğ² | clients-section.tsx | Rate limiting, Ğ¿Ğ¾Ğ²Ñ–Ğ»ÑŒĞ½Ğ° Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ |
| 7 | Optimistic update Ğ±ĞµĞ· rollback | use-activity-log.ts | ĞĞµĞºĞ¾Ğ½ÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ½Ğ¸Ğ¹ UI ÑÑ‚Ğ°Ğ½ |
| 8 | ĞĞµĞ¼Ğ°Ñ” retry Ğ»Ğ¾Ğ³Ñ–ĞºĞ¸ Ğ´Ğ»Ñ Ğ¼ĞµÑ€ĞµĞ¶ĞµĞ²Ğ¸Ñ… Ğ¿Ğ¾Ğ¼Ğ¸Ğ»Ğ¾Ğº | strapi.ts | Ğ’Ñ‚Ñ€Ğ°Ñ‚Ğ° Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ñ–Ğ¹ Ğ¿Ñ€Ğ¸ Ğ½ĞµÑÑ‚Ğ°Ğ±Ñ–Ğ»ÑŒĞ½Ñ–Ğ¹ Ğ¼ĞµÑ€ĞµĞ¶Ñ– |

### 6.3 Ğ¡Ğ•Ğ Ğ•Ğ”ĞĞ†Ğ™ ĞŸĞ Ğ†ĞĞ Ğ˜Ğ¢Ğ•Ğ¢

| # | ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° | ĞœÑ–ÑÑ†Ğµ | Ğ’Ğ¿Ğ»Ğ¸Ğ² |
|---|----------|-------|-------|
| 9 | POS ĞµĞ½Ğ´Ğ¿Ğ¾Ñ–Ğ½Ñ‚Ğ¸ Ğ±ĞµĞ· Ğ°ÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ñ–ĞºĞ°Ñ†Ñ–Ñ— | pos routes | ĞŸĞ¾Ñ‚ĞµĞ½Ñ†Ñ–Ğ¹Ğ½Ğ° Ğ²Ñ€Ğ°Ğ·Ğ»Ğ¸Ğ²Ñ–ÑÑ‚ÑŒ |
| 10 | ĞĞµĞ¼Ğ°Ñ” Ğ²Ğ°Ğ»Ñ–Ğ´Ğ°Ñ†Ñ–Ñ— Ğ½Ğ° ĞºĞ»Ñ–Ñ”Ğ½Ñ‚Ñ– | forms | Ğ—Ğ°Ğ¹Ğ²Ñ– Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ğ¸ Ğ´Ğ¾ ÑĞµÑ€Ğ²ĞµÑ€Ğ° |
| 11 | ĞĞµĞ¼Ğ°Ñ” Ğ¾Ğ±Ğ¼ĞµĞ¶ĞµĞ½Ğ½Ñ Ñ€Ğ¾Ğ·Ğ¼Ñ–Ñ€Ñƒ Ñ„Ğ°Ğ¹Ğ»Ñƒ | import-modal.tsx | DoS Ñ‡ĞµÑ€ĞµĞ· Ğ²ĞµĞ»Ğ¸ĞºÑ– Ñ„Ğ°Ğ¹Ğ»Ğ¸ |
| 12 | ĞĞµĞ¼Ğ°Ñ” Ğ¿Ğ°Ğ³Ñ–Ğ½Ğ°Ñ†Ñ–Ñ— Ğ´Ğ»Ñ ĞºĞ²Ñ–Ñ‚Ñ–Ğ² | products-section.tsx | ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ¸ Ğ· Ğ²ĞµĞ»Ğ¸ĞºĞ¸Ğ¼ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³Ğ¾Ğ¼ |

### 6.4 Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ¸Ğ¹ Ğ°Ğ½Ğ°Ğ»Ñ–Ğ· ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¸Ñ… Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼

#### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° #1: Ğ’Ñ–Ğ´ÑÑƒÑ‚Ğ½Ñ–ÑÑ‚ÑŒ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ñ–Ğ¹ Ğ‘Ğ”

```typescript
// ĞŸĞĞ¢ĞĞ§ĞĞ˜Ğ™ ĞšĞĞ” (Ğ½ĞµĞ±ĞµĞ·Ğ¿ĞµÑ‡Ğ½Ğ¸Ğ¹)
try {
  // ĞĞ¿ĞµÑ€Ğ°Ñ†Ñ–Ñ 1: Ğ´ĞµĞºÑ€ĞµĞ¼ĞµĞ½Ñ‚ stock
  await strapi.db.query('api::variant.variant').update({...});

  // ĞĞ¿ĞµÑ€Ğ°Ñ†Ñ–Ñ 2: ÑÑ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ½Ñ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ñ–Ñ—
  // Ğ¯ĞºÑ‰Ğ¾ Ñ‚ÑƒÑ‚ Ğ¿Ğ¾Ğ¼Ğ¸Ğ»ĞºĞ° - stock Ğ²Ğ¶Ğµ Ğ·Ğ¼ĞµĞ½ÑˆĞµĞ½Ğ¾!
  await strapi.db.query('api::transaction.transaction').create({...});

  // ĞĞ¿ĞµÑ€Ğ°Ñ†Ñ–Ñ 3: Ğ¾Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ ĞºĞ»Ñ–Ñ”Ğ½Ñ‚Ğ°
  await strapi.db.query('api::customer.customer').update({...});
} catch (error) {
  // ĞĞµĞ¼Ğ°Ñ” rollback!
  return { success: false };
}
```

**Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¹ Ğ¿Ñ–Ğ´Ñ…Ñ–Ğ´:**

```typescript
// Ğ— Knex Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ñ–ÑĞ¼Ğ¸
const knex = strapi.db.connection;
await knex.transaction(async (trx) => {
  await trx('variants').where('document_id', variantId).decrement('stock', qty);
  await trx('transactions').insert({...});
  await trx('customers').where('document_id', customerId).update({...});
});
```

#### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° #2: Race condition

```typescript
// Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ñ–Ğ¹ race condition:
// Ğ§Ğ°Ñ T0: ĞšĞ»Ñ–Ñ”Ğ½Ñ‚ A Ğ¿ĞµÑ€ĞµĞ²Ñ–Ñ€ÑÑ” stock = 10
// Ğ§Ğ°Ñ T1: ĞšĞ»Ñ–Ñ”Ğ½Ñ‚ B Ğ¿ĞµÑ€ĞµĞ²Ñ–Ñ€ÑÑ” stock = 10
// Ğ§Ğ°Ñ T2: ĞšĞ»Ñ–Ñ”Ğ½Ñ‚ A ĞºÑƒĞ¿ÑƒÑ” 8 ÑˆÑ‚ â†’ stock = 2
// Ğ§Ğ°Ñ T3: ĞšĞ»Ñ–Ñ”Ğ½Ñ‚ B ĞºÑƒĞ¿ÑƒÑ” 8 ÑˆÑ‚ â†’ stock = -6 (ĞŸĞĞœĞ˜Ğ›ĞšĞ!)
```

**Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¹ Ğ¿Ñ–Ğ´Ñ…Ñ–Ğ´:**

```typescript
// ĞĞ¿Ñ‚Ğ¸Ğ¼Ñ–ÑÑ‚Ğ¸Ñ‡Ğ½Ğµ Ğ±Ğ»Ğ¾ĞºÑƒĞ²Ğ°Ğ½Ğ½Ñ
const result = await strapi.db.query('api::variant.variant').updateMany({
  where: {
    documentId: variant.documentId,
    stock: { $gte: qty }, // Ğ”Ğ¾Ğ´Ğ°Ñ‚ĞºĞ¾Ğ²Ğ° Ğ¿ĞµÑ€ĞµĞ²Ñ–Ñ€ĞºĞ°
  },
  data: { stock: strapi.db.connection.raw('stock - ?', [qty]) },
});

if (result.count === 0) {
  throw new Error('Insufficient stock or concurrent modification');
}
```

---

## 7. ĞĞ±Ñ€Ğ¾Ğ±ĞºĞ° Ğ¿Ğ¾Ğ¼Ğ¸Ğ»Ğ¾Ğº

### 7.1 Frontend

**AdminClient:**
```typescript
// Ğ’Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒÑ” useAlerts hook
const { showSuccess, showError, dismiss } = useAlerts();

// ĞĞ±Ñ€Ğ¾Ğ±ĞºĞ° Ğ¿Ğ¾Ğ¼Ğ¸Ğ»Ğ¾Ğº API
const handleCheckout = async () => {
  try {
    const result = await createSale({...});
    if (result.success) {
      showSuccess(result.alert?.title, result.alert?.message);
    } else {
      showError(
        result.alert?.title || "ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°",
        result.alert?.message || result.error?.message,
        result.error?.details // Ğ”ĞµÑ‚Ğ°Ğ»Ñ– Ğ¿Ğ¾Ğ¼Ğ¸Ğ»Ğ¾Ğº stock
      );
    }
  } catch (error) {
    console.error("Checkout error:", error);
    showError("ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°", "Ğ¡Ñ‚Ğ°Ğ»Ğ°ÑÑ Ğ¿Ğ¾Ğ¼Ğ¸Ğ»ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ñ„Ğ¾Ñ€Ğ¼Ğ»ĞµĞ½Ğ½Ñ–");
  }
};
```

**useActivityLog:**
```typescript
// Optimistic update Ğ· rollback
const logActivity = useCallback(async (type, details) => {
  const newActivity = { id: generateOperationId(), type, timestamp: new Date().toISOString(), details };

  // Optimistic
  setActivities((prev) => [newActivity, ...prev]);

  try {
    const result = await addShiftActivity({ activity: newActivity });
    if (result.success) {
      setActivities(result.data.activities);
    }
  } catch (error) {
    // Rollback
    setActivities((prev) => prev.filter((a) => a.id !== newActivity.id));
  }
}, []);
```

### 7.2 Backend

**POS Controller:**
```typescript
async createSale(ctx: Context) {
  try {
    // Ğ’Ğ°Ğ»Ñ–Ğ´Ğ°Ñ†Ñ–Ñ
    if (!body.operationId) {
      ctx.status = 400;
      ctx.body = {
        success: false,
        error: { code: 'MISSING_OPERATION_ID', message: 'operationId is required' },
      };
      return;
    }

    // Ğ’Ğ¸ĞºĞ»Ğ¸Ğº ÑĞµÑ€Ğ²Ñ–ÑÑƒ
    const result = await posService.createSale(body);

    if (result.success) {
      ctx.status = result.idempotent ? 200 : 201;
      ctx.body = {
        success: true,
        idempotent: result.idempotent,
        data: result.data,
        alert: {
          type: 'success',
          title: result.idempotent ? 'Ğ—Ğ°Ğ¼Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ Ğ²Ğ¶Ğµ Ñ–ÑĞ½ÑƒÑ”' : 'Ğ—Ğ°Ğ¼Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ ÑÑ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ¾',
          message: '...',
        },
      };
    } else {
      ctx.status = result.error?.code === 'INSUFFICIENT_STOCK' ? 409 : 400;
      ctx.body = {
        success: false,
        error: result.error,
        alert: { type: 'error', title: 'ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°', message: result.error?.message },
      };
    }
  } catch (error) {
    strapi.log.error('POS createSale error:', error);
    ctx.status = 500;
    ctx.body = {
      success: false,
      error: { code: 'INTERNAL_ERROR', message: 'An error occurred' },
    };
  }
}
```

### 7.3 ĞšĞ¾Ğ´Ğ¸ Ğ¿Ğ¾Ğ¼Ğ¸Ğ»Ğ¾Ğº

| ĞšĞ¾Ğ´ | HTTP | ĞĞ¿Ğ¸Ñ | Ğ”Ñ–Ñ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡Ğ° |
|-----|------|------|-----------------|
| MISSING_OPERATION_ID | 400 | ĞĞµĞ¼Ğ°Ñ” ID Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ñ–Ñ— | ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚Ğ¸ Ğ·Ğ°Ğ¿Ğ¸Ñ‚ |
| MISSING_CUSTOMER_ID | 400 | ĞĞµ Ğ²Ğ¸Ğ±Ñ€Ğ°Ğ½Ğ¾ ĞºĞ»Ñ–Ñ”Ğ½Ñ‚Ğ° | Ğ’Ğ¸Ğ±Ñ€Ğ°Ñ‚Ğ¸ ĞºĞ»Ñ–Ñ”Ğ½Ñ‚Ğ° |
| MISSING_ITEMS | 400 | ĞŸĞ¾Ñ€Ğ¾Ğ¶Ğ½Ñ–Ğ¹ ĞºĞ¾ÑˆĞ¸Ğº | Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¸ |
| CUSTOMER_NOT_FOUND | 400 | ĞšĞ»Ñ–Ñ”Ğ½Ñ‚ Ğ½Ğµ Ñ–ÑĞ½ÑƒÑ” | ĞŸĞµÑ€ĞµĞ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶Ğ¸Ñ‚Ğ¸ ÑÑ‚Ğ¾Ñ€Ñ–Ğ½ĞºÑƒ |
| VARIANT_NOT_FOUND | 400 | Ğ’Ğ°Ñ€Ñ–Ğ°Ğ½Ñ‚ Ğ½Ğµ Ğ·Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾ | ĞĞ½Ğ¾Ğ²Ğ¸Ñ‚Ğ¸ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³ |
| INSUFFICIENT_STOCK | 409 | ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ½ÑŒĞ¾ Ğ½Ğ° ÑĞºĞ»Ğ°Ğ´Ñ– | Ğ—Ğ¼ĞµĞ½ÑˆĞ¸Ñ‚Ğ¸ ĞºÑ–Ğ»ÑŒĞºÑ–ÑÑ‚ÑŒ |
| INTERNAL_ERROR | 500 | Ğ’Ğ½ÑƒÑ‚Ñ€Ñ–ÑˆĞ½Ñ Ğ¿Ğ¾Ğ¼Ğ¸Ğ»ĞºĞ° | ĞŸĞ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ¸Ñ‚Ğ¸ Ğ°Ğ´Ğ¼Ñ–Ğ½Ğ° |
| NETWORK_ERROR | - | ĞĞµĞ¼Ğ°Ñ” Ğ·'Ñ”Ğ´Ğ½Ğ°Ğ½Ğ½Ñ | ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€Ğ¸Ñ‚Ğ¸ Ñ–Ğ½Ñ‚ĞµÑ€Ğ½ĞµÑ‚ |

---

## 8. Ğ‘ĞµĞ·Ğ¿ĞµĞºĞ°

### 8.1 ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ñ–ĞºĞ°Ñ†Ñ–Ñ

**ĞŸĞ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ° Ñ€ĞµĞ°Ğ»Ñ–Ğ·Ğ°Ñ†Ñ–Ñ:**
```typescript
// frontend/lib/auth.ts
export function getAuthHeaders(): Record<string, string> {
  const token = typeof window !== 'undefined'
    ? localStorage.getItem('admin_token')
    : null;

  return {
    'Content-Type': 'application/json',
    ...(token ? { Authorization: `Bearer ${token}` } : {}),
  };
}
```

**ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€ĞºĞ° Ğ² layout:**
```typescript
// app/admin/layout.tsx
export default async function AdminLayout({ children }) {
  const cookieStore = cookies();
  const token = cookieStore.get('admin_token')?.value;

  if (!token) {
    redirect('/admin/login');
  }

  return <>{children}</>;
}
```

### 8.2 ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ¸ Ğ±ĞµĞ·Ğ¿ĞµĞºĞ¸

| Ğ Ñ–Ğ²ĞµĞ½ÑŒ | ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° | Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ñ–Ñ |
|--------|----------|--------------|
| ğŸ”´ ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¸Ğ¹ | POS ĞµĞ½Ğ´Ğ¿Ğ¾Ñ–Ğ½Ñ‚Ğ¸ Ğ±ĞµĞ· auth | Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ middleware Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ñ–Ñ— |
| ğŸŸ  Ğ’Ğ¸ÑĞ¾ĞºĞ¸Ğ¹ | Ğ¢Ğ¾ĞºĞµĞ½ Ğ² localStorage | Ğ’Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒĞ²Ğ°Ñ‚Ğ¸ httpOnly cookies |
| ğŸŸ  Ğ’Ğ¸ÑĞ¾ĞºĞ¸Ğ¹ | ĞĞµĞ¼Ğ°Ñ” rate limiting | Ğ’Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ´Ğ¸Ñ‚Ğ¸ Strapi rate limiter |
| ğŸŸ¡ Ğ¡ĞµÑ€ĞµĞ´Ğ½Ñ–Ğ¹ | ĞĞµĞ¼Ğ°Ñ” Ğ²Ğ°Ğ»Ñ–Ğ´Ğ°Ñ†Ñ–Ñ— CSRF | Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ CSRF Ñ‚Ğ¾ĞºĞµĞ½Ğ¸ |
| ğŸŸ¡ Ğ¡ĞµÑ€ĞµĞ´Ğ½Ñ–Ğ¹ | Ğ›Ğ¾Ğ³ÑƒĞ²Ğ°Ğ½Ğ½Ñ sensitive Ğ´Ğ°Ğ½Ğ¸Ñ… | Ğ¤Ñ–Ğ»ÑŒÑ‚Ñ€ÑƒĞ²Ğ°Ñ‚Ğ¸ Ğ»Ğ¾Ğ³Ğ¸ |

### 8.3 Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ñ–Ñ—

```typescript
// backend/src/api/pos/routes/pos.ts - ĞŸĞĞ¢ĞĞ§ĞĞ˜Ğ™
export default {
  routes: [
    { method: 'POST', path: '/pos/sales', handler: 'pos.createSale' },
    // ĞĞµĞ¼Ğ°Ñ” middleware!
  ],
};

// Ğ Ğ•ĞšĞĞœĞ•ĞĞ”ĞĞ’ĞĞĞ˜Ğ™
export default {
  routes: [
    {
      method: 'POST',
      path: '/pos/sales',
      handler: 'pos.createSale',
      config: {
        policies: ['is-authenticated'], // Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ Ğ¿Ğ¾Ğ»Ñ–Ñ‚Ğ¸ĞºÑƒ
      },
    },
  ],
};
```

---

## 9. ĞŸĞ»Ğ°Ğ½ Ğ¿Ğ¾ĞºÑ€Ğ°Ñ‰ĞµĞ½ÑŒ

### Ğ¤Ğ°Ğ·Ğ° 1: ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ– Ğ²Ğ¸Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ (ĞĞµĞ³Ğ°Ğ¹Ğ½Ğ¾)

#### 1.1 Ğ’Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ´Ğ¶ĞµĞ½Ğ½Ñ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ñ–Ğ¹ Ğ‘Ğ”

**ĞŸÑ€Ñ–Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚:** ğŸ”´ ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§ĞĞ˜Ğ™
**Ğ¤Ğ°Ğ¹Ğ»Ğ¸:** `backend/src/api/pos/services/pos.ts`
**ĞÑ†Ñ–Ğ½ĞºĞ°:** 4-6 Ğ³Ğ¾Ğ´Ğ¸Ğ½

```typescript
// Ğ’Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ°Ğ½Ğ½Ñ Knex Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ñ–Ğ¹
import { Knex } from 'knex';

async createSale(data: CreateSaleInput) {
  const knex = strapi.db.connection as Knex;

  return knex.transaction(async (trx) => {
    // Ğ’ÑÑ– Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ñ–Ñ— Ğ² Ğ¾Ğ´Ğ½Ñ–Ğ¹ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ñ–Ñ—
    for (const item of data.items) {
      const updated = await trx('variants')
        .where('document_id', variant.documentId)
        .andWhere('stock', '>=', item.qty)
        .decrement('stock', item.qty);

      if (updated === 0) {
        throw new Error(`Insufficient stock for ${item.name}`);
      }
    }

    const [transaction] = await trx('transactions').insert({...}).returning('*');
    return transaction;
  });
}
```

#### 1.2 Ğ—Ğ°Ñ…Ğ¸ÑÑ‚ POS ĞµĞ½Ğ´Ğ¿Ğ¾Ñ–Ğ½Ñ‚Ñ–Ğ²

**ĞŸÑ€Ñ–Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚:** ğŸ”´ ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§ĞĞ˜Ğ™
**Ğ¤Ğ°Ğ¹Ğ»Ğ¸:** `backend/src/api/pos/routes/pos.ts`
**ĞÑ†Ñ–Ğ½ĞºĞ°:** 1-2 Ğ³Ğ¾Ğ´Ğ¸Ğ½Ğ¸

```typescript
// Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ middleware
export default {
  routes: [
    {
      method: 'POST',
      path: '/pos/sales',
      handler: 'pos.createSale',
      config: {
        middlewares: ['api::pos.rate-limit'],
        policies: ['global::is-authenticated'],
      },
    },
  ],
};
```

#### 1.3 Race condition Ğ·Ğ°Ñ…Ğ¸ÑÑ‚

**ĞŸÑ€Ñ–Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚:** ğŸ”´ ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§ĞĞ˜Ğ™
**Ğ¤Ğ°Ğ¹Ğ»Ğ¸:** `backend/src/api/pos/services/pos.ts`
**ĞÑ†Ñ–Ğ½ĞºĞ°:** 2-3 Ğ³Ğ¾Ğ´Ğ¸Ğ½Ğ¸

```typescript
// ĞÑ‚Ğ¾Ğ¼Ğ°Ñ€Ğ½Ğ¸Ğ¹ Ğ´ĞµĞºÑ€ĞµĞ¼ĞµĞ½Ñ‚ Ğ· Ğ¿ĞµÑ€ĞµĞ²Ñ–Ñ€ĞºĞ¾Ñ
const result = await knex.raw(`
  UPDATE variants
  SET stock = stock - ?
  WHERE document_id = ? AND stock >= ?
  RETURNING stock
`, [qty, documentId, qty]);

if (result.rows.length === 0) {
  throw new Error('Stock depleted or concurrent modification');
}
```

### Ğ¤Ğ°Ğ·Ğ° 2: Ğ’Ğ°Ğ¶Ğ»Ğ¸Ğ²Ñ– Ğ¿Ğ¾ĞºÑ€Ğ°Ñ‰ĞµĞ½Ğ½Ñ (1-2 Ñ‚Ğ¸Ğ¶Ğ½Ñ–)

#### 2.1 ĞšĞ»Ñ–Ñ”Ğ½Ñ‚ÑÑŒĞºĞ° Ğ²Ğ°Ğ»Ñ–Ğ´Ğ°Ñ†Ñ–Ñ stock

**Ğ¤Ğ°Ğ¹Ğ»:** `frontend/components/sections/pos-section.tsx`

```typescript
const addToCart = (product: Product, variant: Variant) => {
  // ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€ĞºĞ° Ğ¿ĞµÑ€ĞµĞ´ Ğ´Ğ¾Ğ´Ğ°Ğ²Ğ°Ğ½Ğ½ÑĞ¼
  const currentInCart = cart.find(l => l.id === `${product.id}-${variant.length}`)?.qty || 0;
  const newQty = currentInCart + 25;

  if (newQty > variant.stock) {
    showWarning(`ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ½ÑŒĞ¾ Ğ½Ğ° ÑĞºĞ»Ğ°Ğ´Ñ–. Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾: ${variant.stock}`);
    return;
  }

  // ... Ğ´Ğ¾Ğ´Ğ°Ğ²Ğ°Ğ½Ğ½Ñ Ğ´Ğ¾ ĞºĞ¾ÑˆĞ¸ĞºĞ°
};
```

#### 2.2 ĞĞ¿Ñ‚Ğ¸Ğ¼Ñ–Ğ·Ğ°Ñ†Ñ–Ñ Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ ĞºĞ»Ñ–Ñ”Ğ½Ñ‚Ñ–Ğ²

**Ğ¤Ğ°Ğ¹Ğ»:** `frontend/components/sections/clients-section.tsx`

```typescript
// Ğ—Ğ°Ğ¼Ñ–ÑÑ‚ÑŒ Ğ¿Ğ°Ñ€Ğ°Ğ»ĞµĞ»ÑŒĞ½Ğ¸Ñ… Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ñ–Ğ² - batch endpoint
const loadClientsWithStats = async () => {
  // ĞĞ´Ğ¸Ğ½ Ğ·Ğ°Ğ¿Ğ¸Ñ‚ Ğ·Ğ°Ğ¼Ñ–ÑÑ‚ÑŒ N
  const result = await fetch(`${API_URL}/customers/with-stats`);
  // Backend Ğ°Ğ³Ñ€ĞµĞ³ÑƒÑ” Ğ´Ğ°Ğ½Ñ–
};
```

#### 2.3 Retry Ğ»Ğ¾Ğ³Ñ–ĞºĞ°

**Ğ¤Ğ°Ğ¹Ğ»:** `frontend/lib/strapi.ts`

```typescript
async function fetchWithRetry<T>(
  url: string,
  options: RequestInit,
  retries = 3
): Promise<T> {
  for (let i = 0; i < retries; i++) {
    try {
      const response = await fetch(url, options);
      if (response.ok) return response.json();
      if (response.status >= 500) throw new Error('Server error');
      return response.json();
    } catch (error) {
      if (i === retries - 1) throw error;
      await new Promise(r => setTimeout(r, 1000 * (i + 1)));
    }
  }
}
```

### Ğ¤Ğ°Ğ·Ğ° 3: ĞŸĞ¾ĞºÑ€Ğ°Ñ‰ĞµĞ½Ğ½Ñ UX (2-4 Ñ‚Ğ¸Ğ¶Ğ½Ñ–)

#### 3.1 Offline mode Ğ´Ğ»Ñ POS

```typescript
// Service Worker + IndexedDB
const offlineCart = new OfflineQueue('pos-sales');

const handleCheckout = async () => {
  if (!navigator.onLine) {
    await offlineCart.add(saleData);
    showInfo('Ğ—Ğ±ĞµÑ€ĞµĞ¶ĞµĞ½Ğ¾ Ğ¾Ñ„Ğ»Ğ°Ğ¹Ğ½. Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ñ–Ğ·Ğ°Ñ†Ñ–Ñ Ğ¿Ñ€Ğ¸ Ğ¿Ñ–Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ½Ñ–.');
    return;
  }
  // ... Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¸Ğ¹ checkout
};

// Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ñ–Ğ·Ğ°Ñ†Ñ–Ñ Ğ¿Ñ€Ğ¸ Ğ²Ñ–Ğ´Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ– Ğ·Ğ²'ÑĞ·ĞºÑƒ
window.addEventListener('online', async () => {
  const pending = await offlineCart.getAll();
  for (const sale of pending) {
    await createSale(sale);
    await offlineCart.remove(sale.id);
  }
});
```

#### 3.2 Real-time Ğ¾Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ stock

```typescript
// WebSocket Ğ°Ğ±Ğ¾ Server-Sent Events
const stockUpdates = new EventSource('/api/stock/updates');

stockUpdates.onmessage = (event) => {
  const { variantId, newStock } = JSON.parse(event.data);
  setProducts(prev => prev.map(p => ({
    ...p,
    variants: p.variants.map(v =>
      v.documentId === variantId ? { ...v, stock: newStock } : v
    ),
  })));
};
```

#### 3.3 ĞŸĞ°Ğ³Ñ–Ğ½Ğ°Ñ†Ñ–Ñ Ñ‚Ğ° Ğ²Ñ–Ñ€Ñ‚ÑƒĞ°Ğ»Ñ–Ğ·Ğ°Ñ†Ñ–Ñ

```typescript
// Ğ”Ğ»Ñ Ğ²ĞµĞ»Ğ¸ĞºĞ¸Ñ… ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³Ñ–Ğ²
import { useVirtualizer } from '@tanstack/react-virtual';

const ProductList = ({ products }) => {
  const parentRef = useRef(null);
  const virtualizer = useVirtualizer({
    count: products.length,
    getScrollElement: () => parentRef.current,
    estimateSize: () => 200,
  });

  return (
    <div ref={parentRef} style={{ height: '600px', overflow: 'auto' }}>
      {virtualizer.getVirtualItems().map(item => (
        <ProductCard key={item.key} product={products[item.index]} />
      ))}
    </div>
  );
};
```

### Ğ¤Ğ°Ğ·Ğ° 4: Ğ Ğ¾Ğ·ÑˆĞ¸Ñ€ĞµĞ½Ğ½Ñ Ñ„ÑƒĞ½ĞºÑ†Ñ–Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ñ–

#### 4.1 ĞÑƒĞ´Ğ¸Ñ‚ Ğ»Ğ¾Ğ³

```typescript
// ĞŸĞ¾Ğ²Ğ½Ğ¸Ğ¹ Ñ‚Ñ€ĞµĞºÑ–Ğ½Ğ³ Ğ²ÑÑ–Ñ… Ğ·Ğ¼Ñ–Ğ½
interface AuditLog {
  id: string;
  userId: string;
  action: 'create' | 'update' | 'delete';
  entity: 'flower' | 'variant' | 'customer' | 'transaction';
  entityId: string;
  changes: Record<string, { old: unknown; new: unknown }>;
  timestamp: string;
  ipAddress: string;
}
```

#### 4.2 Ğ—Ğ²Ñ–Ñ‚Ğ¸ Ñ‚Ğ° ĞµĞºÑĞ¿Ğ¾Ñ€Ñ‚

- Ğ©Ğ¾Ğ´ĞµĞ½Ğ½Ñ–/Ñ‚Ğ¸Ğ¶Ğ½ĞµĞ²Ñ– Ğ·Ğ²Ñ–Ñ‚Ğ¸ Ğ¿Ñ€Ğ¾Ğ´Ğ°Ğ¶Ñ–Ğ²
- ĞĞ½Ğ°Ğ»Ñ–Ğ· Ğ¿Ğ¾ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ñ–ÑÑ…
- ĞŸÑ€Ğ¾Ğ³Ğ½Ğ¾Ğ·ÑƒĞ²Ğ°Ğ½Ğ½Ñ stock
- Ğ•ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ² PDF/Excel

#### 4.3 Ğ†Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ñ–Ñ—

- SMS/Email Ğ½Ğ¾Ñ‚Ğ¸Ñ„Ñ–ĞºĞ°Ñ†Ñ–Ñ— ĞºĞ»Ñ–Ñ”Ğ½Ñ‚Ğ°Ğ¼
- Ğ†Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ñ–Ñ Ğ· Ğ±ÑƒÑ…Ğ³Ğ°Ğ»Ñ‚ĞµÑ€ÑÑŒĞºĞ¸Ğ¼Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°Ğ¼Ğ¸
- Ğ¡Ğ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ñ–Ğ·Ğ°Ñ†Ñ–Ñ Ğ· Ğ¿Ğ¾ÑÑ‚Ğ°Ñ‡Ğ°Ğ»ÑŒĞ½Ğ¸ĞºĞ°Ğ¼Ğ¸

---

## ĞŸÑ–Ğ´ÑÑƒĞ¼Ğ¾Ğº

### Ğ©Ğ¾ Ğ¿Ñ€Ğ°Ñ†ÑÑ” Ğ´Ğ¾Ğ±Ñ€Ğµ âœ…

1. **Ğ†Ğ´ĞµĞ¼Ğ¿Ğ¾Ñ‚ĞµĞ½Ñ‚Ğ½Ñ–ÑÑ‚ÑŒ** - operationId Ğ·Ğ°Ğ¿Ğ¾Ğ±Ñ–Ğ³Ğ°Ñ” Ğ´ÑƒĞ±Ğ»Ñ–ĞºĞ°Ñ‚Ğ°Ğ¼
2. **Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° ĞºĞ¾Ğ´Ñƒ** - Ñ‡Ñ–Ñ‚ĞºĞ¸Ğ¹ Ğ¿Ğ¾Ğ´Ñ–Ğ» Ğ½Ğ° ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¸/Ñ…ÑƒĞºĞ¸/ÑĞµÑ€Ğ²Ñ–ÑĞ¸
3. **TypeScript** - ÑĞ¸Ğ»ÑŒĞ½Ğ° Ñ‚Ğ¸Ğ¿Ñ–Ğ·Ğ°Ñ†Ñ–Ñ
4. **UI/UX** - responsive, Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ğ¸Ğ¹ Ğ´Ğ¸Ğ·Ğ°Ğ¹Ğ½
5. **Activity logging** - Ğ¿Ğ¾Ğ²Ğ½Ğ° Ñ–ÑÑ‚Ğ¾Ñ€Ñ–Ñ Ğ´Ñ–Ğ¹
6. **Multi-device sync** - polling Ğ´Ğ»Ñ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ñ–Ğ·Ğ°Ñ†Ñ–Ñ—

### Ğ©Ğ¾ Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±ÑƒÑ” ÑƒĞ²Ğ°Ğ³Ğ¸ âš ï¸

1. **Ğ¢Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ñ–Ñ— Ğ‘Ğ”** - Ğ²Ñ–Ğ´ÑÑƒÑ‚Ğ½Ñ–, Ñ€Ğ¸Ğ·Ğ¸Ğº Ñ‡Ğ°ÑÑ‚ĞºĞ¾Ğ²Ğ¸Ñ… Ğ·Ğ¼Ñ–Ğ½
2. **Race conditions** - Ğ¼Ğ¾Ğ¶Ğ»Ğ¸Ğ²Ğ¸Ğ¹ oversell
3. **Ğ‘ĞµĞ·Ğ¿ĞµĞºĞ° POS** - Ğ¿ÑƒĞ±Ğ»Ñ–Ñ‡Ğ½Ñ– ĞµĞ½Ğ´Ğ¿Ğ¾Ñ–Ğ½Ñ‚Ğ¸
4. **Ğ’Ğ°Ğ»Ñ–Ğ´Ğ°Ñ†Ñ–Ñ Ğ½Ğ° ĞºĞ»Ñ–Ñ”Ğ½Ñ‚Ñ–** - Ğ½ĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ½Ñ
5. **Error recovery** - Ğ½ĞµĞ¼Ğ°Ñ” retry Ğ»Ğ¾Ğ³Ñ–ĞºĞ¸

### Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¹ Ğ¿Ğ¾Ñ€ÑĞ´Ğ¾Ğº Ğ´Ñ–Ğ¹

1. ğŸ”´ **ĞĞµĞ³Ğ°Ğ¹Ğ½Ğ¾:** Ğ¢Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ñ–Ñ— Ğ‘Ğ” + POS auth
2. ğŸŸ  **Ğ¢Ğ¸Ğ¶Ğ´ĞµĞ½ÑŒ 1:** Race condition Ğ·Ğ°Ñ…Ğ¸ÑÑ‚ + Ğ²Ğ°Ğ»Ñ–Ğ´Ğ°Ñ†Ñ–Ñ
3. ğŸŸ¡ **Ğ¢Ğ¸Ğ¶Ğ´ĞµĞ½ÑŒ 2-3:** ĞĞ¿Ñ‚Ğ¸Ğ¼Ñ–Ğ·Ğ°Ñ†Ñ–Ñ + retry Ğ»Ğ¾Ğ³Ñ–ĞºĞ°
4. ğŸŸ¢ **Ğ¢Ğ¸Ğ¶Ğ´ĞµĞ½ÑŒ 4+:** UX Ğ¿Ğ¾ĞºÑ€Ğ°Ñ‰ĞµĞ½Ğ½Ñ + Ñ€Ğ¾Ğ·ÑˆĞ¸Ñ€ĞµĞ½Ğ½Ñ

---

*Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚ ÑÑ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ¾: 2025-12-23*
*ĞĞ²Ñ‚Ğ¾Ñ€: Claude Code Analysis*
