# –°–∏—Å—Ç–µ–º–∞ —ñ–º–ø–æ—Ä—Ç—É –Ω–∞–∫–ª–∞–¥–Ω–∏—Ö

## –û–≥–ª—è–¥

–°–∏—Å—Ç–µ–º–∞ —ñ–º–ø–æ—Ä—Ç—É –Ω–∞–∫–ª–∞–¥–Ω–∏—Ö –¥–æ–∑–≤–æ–ª—è—î –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ Excel —Ñ–∞–π–ª–∏ –∑ –¥–∞–Ω–∏–º–∏ –ø—Ä–æ –∫–≤—ñ—Ç–∏ —Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –±–∞–∑—É –¥–∞–Ω–∏—Ö. –ü—ñ—Å–ª—è —ñ–º–ø–æ—Ä—Ç—É –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Ü—ñ–Ω–∏ –ø—Ä–æ–¥–∞–∂—É –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä—É.

---

## –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º–∏

### –ü–æ—Ç—ñ–∫ –¥–∞–Ω–∏—Ö

```
Excel —Ñ–∞–π–ª (.xlsx/.xls)
        ‚Üì
   [1] Parser Service
   (–≤–∏—Ç—è–≥—É–≤–∞–Ω–Ω—è —Ä—è–¥–∫—ñ–≤)
        ‚Üì
   [2] Normalizer Service
   (–Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –Ω–∞–∑–≤, –¥–æ–≤–∂–∏–Ω, —Ü—ñ–Ω)
        ‚Üì
   [3] Validator Service
   (–≤–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö)
        ‚Üì
   [4] Upserter Service
   (—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è/–æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ø–∏—Å—ñ–≤)
        ‚Üì
   [5] Supply Record
   (–∞—É–¥–∏—Ç –ª–æ–≥—É–≤–∞–Ω–Ω—è)
        ‚Üì
   [6] Pricing Table UI
   (–≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ü—ñ–Ω –ø—Ä–æ–¥–∞–∂—É)
```

### –ö–ª—é—á–æ–≤—ñ —Ñ–∞–π–ª–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –®–ª—è—Ö | –û–ø–∏—Å |
|-----------|------|------|
| **Frontend** | | |
| Import Modal | `frontend/components/ui/import-modal.tsx` | UI –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ü—ñ–Ω |
| Import API | `frontend/lib/api/import.ts` | API —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è —ñ–º–ø–æ—Ä—Ç—É |
| Import Types | `frontend/lib/types/import.ts` | TypeScript —Ç–∏–ø–∏ |
| **Backend** | | |
| Controller | `backend/src/api/import/controllers/import.ts` | HTTP –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ |
| Routes | `backend/src/api/import/routes/import.ts` | –ú–∞—Ä—à—Ä—É—Ç–∏ API |
| Import Service | `backend/src/api/import/services/import.ts` | –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü—ñ—è —ñ–º–ø–æ—Ä—Ç—É |
| Parser Service | `backend/src/services/excel/parser.service.ts` | –ü–∞—Ä—Å–∏–Ω–≥ Excel |
| Normalizer Service | `backend/src/services/excel/normalizer.service.ts` | –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö |
| Validator Service | `backend/src/services/excel/validator.service.ts` | –í–∞–ª—ñ–¥–∞—Ü—ñ—è |
| Upserter Service | `backend/src/services/excel/upserter.service.ts` | Upsert –≤ –ë–î |
| Types | `backend/src/services/excel/types.ts` | TypeScript —Ç–∏–ø–∏ |

---

## –î–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å –µ—Ç–∞–ø—ñ–≤

### 1. Parser Service (`parser.service.ts`)

**–§—É–Ω–∫—Ü—ñ—è:** –ß–∏—Ç–∞–Ω–Ω—è Excel —Ñ–∞–π–ª—É —Ç–∞ –≤–∏—Ç—è–≥—É–≤–∞–Ω–Ω—è —Ä—è–¥–∫—ñ–≤ –¥–∞–Ω–∏—Ö.

**–ü—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ —Ñ–æ—Ä–º–∞—Ç–∏:**

| –§–æ—Ä–º–∞—Ç | –û–∑–Ω–∞–∫–∏ | –ü–æ–∑–∏—Ü—ñ—ó –∫–æ–ª–æ–Ω–æ–∫ |
|--------|--------|-----------------|
| **Colombia/Makavchuk** | –ú–∞—î "—Ü–µ–Ω–∞", "—Å—É–º–º–∞", "awb" –≤ –ø–µ—Ä—à–æ–º—É —Ä—è–¥–∫—É | –§—ñ–∫—Å–æ–≤–∞–Ω—ñ: 0=qbCode, 1=variety, 2=type, 3=grade, 4=units, 5=supplier, 6=recipient, 7=price, 8=total, 9=awb |
| **Ross** | –Ü—Å–ø–∞–Ω—Å—å–∫—ñ –∑–∞–≥–æ–ª–æ–≤–∫–∏: CULTIVOS, VARIEDAD, GRADO, TALLOS, PRECIO | –ê–≤—Ç–æ–¥–µ—Ç–µ–∫—Ç –∑–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ |
| **Generic** | –ê–≤—Ç–æ–¥–µ—Ç–µ–∫—Ç –∑–∞ –∫–ª—é—á–æ–≤–∏–º–∏ —Å–ª–æ–≤–∞–º–∏ | –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –∑–∞ –∫–ª—é—á–æ–≤–∏–º–∏ —Å–ª–æ–≤–∞–º–∏ |

**–ö–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞ –¥–ª—è –∞–≤—Ç–æ–¥–µ—Ç–µ–∫—Ç—É –∫–æ–ª–æ–Ω–æ–∫:**

```typescript
const columnKeywords = {
  variety: ['variety', 'variedad', '—Å–æ—Ä—Ç', '–Ω–∞–∑–≤–∞', 'name', 'flower'],
  type: ['type', '—Ç–∏–ø', '–≤–∏–¥'],
  grade: ['grade', 'grado', 'length', 'height', '–¥–æ–≤–∂–∏–Ω–∞', '—Ä–æ–∑–º—ñ—Ä', 'size', 'cm', '—Å–º'],
  units: ['units', 'qty', 'quantity', 'tallos', 'stems', '–∫—ñ–ª—å–∫—ñ—Å—Ç—å', '—à—Ç', 'stock'],
  price: ['price', 'precio', '—Ü—ñ–Ω–∞', '—Ü–µ–Ω–∞', 'cost', 'uah', 'usd', 'eur'],
  supplier: ['supplier', 'farm', 'cultivos', '–ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫', '—Ñ–µ—Ä–º–∞', 'fb'],
  awb: ['awb', 'waybill', '–Ω–∞–∫–ª–∞–¥–Ω–∞'],
};
```

**–í–∏—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ (`ParsedRow`):**

```typescript
interface ParsedRow {
  rowIndex: number;       // –ù–æ–º–µ—Ä —Ä—è–¥–∫–∞ (1-based)
  original: Record<string, unknown>;  // –û—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ
  variety: string;        // –ù–∞–∑–≤–∞ —Å–æ—Ä—Ç—É
  type: string | null;    // –¢–∏–ø (rose, hydrangea, etc.)
  grade: string;          // –î–æ–≤–∂–∏–Ω–∞/grade
  units: number;          // –ö—ñ–ª—å–∫—ñ—Å—Ç—å
  price: number;          // –¶—ñ–Ω–∞ –∑–∞ –æ–¥–∏–Ω–∏—Ü—é
  total: number | null;   // –ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞
  supplier: string | null;
  awb: string | null;
}
```

---

### 2. Normalizer Service (`normalizer.service.ts`)

**–§—É–Ω–∫—Ü—ñ—è:** –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—ñ.

**–ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –Ω–∞–∑–≤–∏ –∫–≤—ñ—Ç–∫–∏:**

1. –û–±'—î–¥–Ω–∞–Ω–Ω—è `variety + type` (—è–∫—â–æ –Ω–µ –¥—É–±–ª—é—é—Ç—å—Å—è)
2. Title Case: `"freedom rose"` ‚Üí `"Freedom Rose"`
3. –°–ª–æ–≤–Ω–∏–∫ —Å–∏–Ω–æ–Ω—ñ–º—ñ–≤: `"Freedom"` ‚Üí `"Freedom Rose"`
4. Slug –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è: `"Freedom Rose"` ‚Üí `"freedom-rose"`

**–°–ª–æ–≤–Ω–∏–∫ —Å–∏–Ω–æ–Ω—ñ–º—ñ–≤ (–ø—Ä–∏–∫–ª–∞–¥):**

```typescript
const flowerNameSynonyms = {
  'Freedom Rose': ['Freedom', 'Freedom R', 'Freedomrose'],
  'Explorer Rose': ['Explorer', 'Explorer R'],
  'Pink Floyd Rose': ['Pink Floyd', 'Pinkfloyd'],
  // ... 100+ —Å–∏–Ω–æ–Ω—ñ–º—ñ–≤
};
```

**–ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è grade/length:**

| –í—Ö—ñ–¥ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|------|-----------|
| `"90cm"` | `length: 90, grade: null` |
| `"90"` | `length: 90, grade: null` |
| `"jumbo"` | `length: null, grade: "Jumbo"` |
| `"premium"` | `length: null, grade: "Premium"` |

**–¢–µ–∫—Å—Ç–æ–≤—ñ grade (–Ω–µ –∫–æ–Ω–≤–µ—Ä—Ç—É—é—Ç—å—Å—è –≤ —á–∏—Å–ª–∞):**
- jumbo, premium, select, standard, mini, xl, xxl

**–ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è stock:**
```typescript
stock = Math.round(Math.abs(units));  // –û–∫—Ä—É–≥–ª–µ–Ω–Ω—è –¥–æ —Ü—ñ–ª–æ–≥–æ
```

**–ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è price:**
```typescript
price = Math.round(Math.abs(price) * 100) / 100;  // 2 –∑–Ω–∞–∫–∏ –ø—ñ—Å–ª—è –∫–æ–º–∏
```

**–í–∏—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ (`NormalizedRow`):**

```typescript
interface NormalizedRow {
  rowIndex: number;
  original: Record<string, unknown>;
  flowerName: string;     // –ù–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ –Ω–∞–∑–≤–∞
  slug: string;           // URL-safe slug
  length: number | null;  // –î–æ–≤–∂–∏–Ω–∞ –≤ —Å–º
  grade: string | null;   // –¢–µ–∫—Å—Ç–æ–≤–∏–π grade
  stock: number;          // –ö—ñ–ª—å–∫—ñ—Å—Ç—å
  price: number;          // –°–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å
  supplier: string | null;
  awb: string | null;
  hash: string;           // SHA-256 —Ö–µ—à —Ä—è–¥–∫–∞
}
```

---

### 3. Validator Service (`validator.service.ts`)

**–§—É–Ω–∫—Ü—ñ—è:** –í–∞–ª—ñ–¥–∞—Ü—ñ—è –Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∏—Ö –¥–∞–Ω–∏—Ö.

**–ü—Ä–∞–≤–∏–ª–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó:**

| –ü–æ–ª–µ | –ü—Ä–∞–≤–∏–ª–∞ |
|------|---------|
| `flowerName` | –û–±–æ–≤'—è–∑–∫–æ–≤–µ, 2-200 —Å–∏–º–≤–æ–ª—ñ–≤ |
| `slug` | –û–±–æ–≤'—è–∑–∫–æ–≤–µ, 2-200 —Å–∏–º–≤–æ–ª—ñ–≤ |
| `length` | –û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ, —è–∫—â–æ —î: 1-500 —Å–º |
| `grade` | –û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ |
| `stock` | –û–±–æ–≤'—è–∑–∫–æ–≤–µ, 0-1,000,000 |
| `price` | –û–±–æ–≤'—è–∑–∫–æ–≤–µ, 0.01-100,000 |

**–í–ê–ñ–õ–ò–í–û:** –†—è–¥–æ–∫ –ø–æ–≤–∏–Ω–µ–Ω –º–∞—Ç–∏ –∞–±–æ `length`, –∞–±–æ `grade`.

**–í–∏—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ:**

```typescript
interface ValidationResult {
  valid: NormalizedRow[];    // –í–∞–ª—ñ–¥–Ω—ñ —Ä—è–¥–∫–∏
  errors: ImportError[];     // –ü–æ–º–∏–ª–∫–∏
  warnings: ImportWarning[]; // –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è
}
```

---

### 4. Upserter Service (`upserter.service.ts`)

**–§—É–Ω–∫—Ü—ñ—è:** –°—Ç–≤–æ—Ä–µ–Ω–Ω—è/–æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ø–∏—Å—ñ–≤ —É –±–∞–∑—ñ –¥–∞–Ω–∏—Ö.

**–õ–æ–≥—ñ–∫–∞ upsert:**

1. **–ì—Ä—É–ø—É–≤–∞–Ω–Ω—è –∑–∞ slug** - —Ä—è–¥–∫–∏ –∑ –æ–¥–Ω–∞–∫–æ–≤–∏–º slug –Ω–∞–ª–µ–∂–∞—Ç—å –æ–¥–Ω—ñ–π –∫–≤—ñ—Ç—Ü—ñ
2. **Upsert Flower** - —Å—Ç–≤–æ—Ä–∏—Ç–∏ –∫–≤—ñ—Ç–∫—É, —è–∫—â–æ –Ω–µ —ñ—Å–Ω—É—î
3. **Upsert Variants** - –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –≤–∞—Ä—ñ–∞–Ω—Ç—É (length):
   - –Ø–∫—â–æ —ñ—Å–Ω—É—î: –æ–Ω–æ–≤–∏—Ç–∏ `stock` —Ç–∞ `costPrice`
   - –Ø–∫—â–æ –Ω–µ —ñ—Å–Ω—É—î: —Å—Ç–≤–æ—Ä–∏—Ç–∏ –∑ `stock`, `costPrice`, `price=0`

**–†–µ–∂–∏–º–∏ stock (`stockMode`):**

| –†–µ–∂–∏–º | –û–ø–∏—Å | –ü—Ä–∏–∫–ª–∞–¥ |
|-------|------|---------|
| `replace` | –ó–∞–º—ñ–Ω–∏—Ç–∏ stock | old: 100, new: 50 ‚Üí 50 |
| `add` | –î–æ–¥–∞—Ç–∏ –¥–æ stock | old: 100, new: 50 ‚Üí 150 |
| `skip` | –ù–µ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ | old: 100, new: 50 ‚Üí 100 |

**–ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Ü—ñ–Ω:**

```typescript
// –ü—Ä–∏ —ñ–º–ø–æ—Ä—Ç—ñ:
costPrice = row.price;  // –°–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å –∑ Excel
price = existing?.price ?? 0;  // –¶—ñ–Ω–∞ –ø—Ä–æ–¥–∞–∂—É –Ω–µ –∑–º—ñ–Ω—é—î—Ç—å—Å—è
```

**–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è grade –≤ length:**

```typescript
const gradeMap = {
  mini: 10,
  standard: 40,
  select: 60,
  premium: 80,
  jumbo: 100,
  xl: 110,
  xxl: 120,
};
```

---

### 5. Supply Record

**–§—É–Ω–∫—Ü—ñ—è:** –ê—É–¥–∏—Ç –ª–æ–≥—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö —ñ–º–ø–æ—Ä—Ç—ñ–≤.

**–ó–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ —Ç–∞–±–ª–∏—Ü—ñ `supplies`:**

```typescript
interface SupplyData {
  filename: string;        // –Ü–º'—è —Ñ–∞–π–ª—É
  checksum: string;        // SHA-256 —Ö–µ—à —Ñ–∞–π–ª—É
  dateParsed: string;      // –î–∞—Ç–∞ —ñ–º–ø–æ—Ä—Ç—É
  awb: string | null;      // AWB –Ω–æ–º–µ—Ä
  supplier: string | null; // –ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫
  rows: SupplyRowData[];   // –í—Å—ñ —Ä—è–¥–∫–∏ (JSON)
  supplyStatus: 'success' | 'failed' | 'dry-run';
  supplyErrors: ImportError[];
  supplyWarnings: ImportWarning[];
  users_permissions_user: number | null;  // –•—Ç–æ —ñ–º–ø–æ—Ä—Ç—É–≤–∞–≤
}
```

**–î—É–±–ª—ñ–∫–∞—Ç —Ñ–∞–π–ª—É:**
- –°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—î SHA-256 checksum
- –Ø–∫—â–æ —Ñ–∞–π–ª –≤–∂–µ –±—É–≤ —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–∏–π ‚Üí –ø–æ–º–∏–ª–∫–∞ `DUPLICATE_CHECKSUM`
- –ú–æ–∂–Ω–∞ –ø—Ä–∏–º—É—Å–æ–≤–æ —ñ–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏: `forceImport: true`

---

### 6. Pricing Table UI

**–§—É–Ω–∫—Ü—ñ—è:** –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ü—ñ–Ω –ø—Ä–æ–¥–∞–∂—É –ø—ñ—Å–ª—è —ñ–º–ø–æ—Ä—Ç—É.

**–ö—Ä–æ–∫–∏ —Ä–æ–±–æ—Ç–∏:**

1. **–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É** ‚Üí –Ω–∞—Ç–∏—Å–Ω—É—Ç–∏ "–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏"
2. **–ü—Ä–µ–≤ º—é (dry-run)** ‚Üí –ø–æ–∫–∞–∑—É—î:
   - –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ä—è–¥–∫—ñ–≤, –≤–∞–ª—ñ–¥–Ω–∏—Ö, –ø–æ–º–∏–ª–æ–∫
   - –¢–∞–±–ª–∏—Ü—è –∑ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è–º: –ö—ñ–ª—å–∫—ñ—Å—Ç—å (Excel) vs –ö—ñ–ª—å–∫—ñ—Å—Ç—å (—ñ–º–ø–æ—Ä—Ç)
   - –ñ–æ–≤—Ç–∏–º –ø—ñ–¥—Å–≤—ñ—á—É—é—Ç—å—Å—è —Ä–æ–∑–±—ñ–∂–Ω–æ—Å—Ç—ñ
3. **–ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è** ‚Üí –Ω–∞—Ç–∏—Å–Ω—É—Ç–∏ "–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏"
4. **–¢–∞–±–ª–∏—Ü—è —Ü—ñ–Ω** ‚Üí –ø–æ–∫–∞–∑—É—î:
   - –ù–∞–∑–≤–∞, –î–æ–≤–∂–∏–Ω–∞, –ö—ñ–ª—å–∫—ñ—Å—Ç—å (Excel/—ñ–º–ø–æ—Ä—Ç), –°–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å
   - –ü–æ—Ä–æ–∂–Ω—è –∫–æ–ª–æ–Ω–∫–∞ "–¶—ñ–Ω–∞ –ø—Ä–æ–¥–∞–∂—É" –¥–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è
5. **–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è** ‚Üí "–ó–±–µ—Ä–µ–≥—Ç–∏ —Ü—ñ–Ω–∏" –∞–±–æ "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç–∏"

---

## API –ï–Ω–¥–ø–æ—ñ–Ω—Ç–∏

### POST `/api/imports/excel`

**–û–ø–∏—Å:** –Ü–º–ø–æ—Ä—Ç Excel —Ñ–∞–π–ª—É.

**Request:**
```
Content-Type: multipart/form-data

file: <Excel file>
dryRun: "true" | "false"
stockMode: "replace" | "add" | "skip"
forceImport: "true" | "false"
awb: string (optional)
supplier: string (optional)
```

**Response (success):**
```json
{
  "success": true,
  "data": {
    "supplyId": 123,
    "status": "success" | "dry-run",
    "stats": {
      "totalRows": 50,
      "validRows": 48,
      "flowersCreated": 10,
      "flowersUpdated": 15,
      "variantsCreated": 25,
      "variantsUpdated": 23
    },
    "errors": [],
    "warnings": [],
    "rows": [...],
    "operations": [...]
  }
}
```

**Response (error):**
```json
{
  "success": false,
  "error": {
    "code": "DUPLICATE_CHECKSUM" | "VALIDATION_FAILED" | "INVALID_FORMAT",
    "message": "...",
    "existingSupplyId": 100
  }
}
```

---

### POST `/api/imports/update-prices`

**–û–ø–∏—Å:** Batch –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ü—ñ–Ω –ø—Ä–æ–¥–∞–∂—É –¥–ª—è –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤.

**Request:**
```json
{
  "prices": [
    { "documentId": "abc123", "price": 150.00 },
    { "documentId": "def456", "price": 200.00 }
  ]
}
```

**Response:**
```json
{
  "success": true,
  "updated": 2
}
```

---

## –°—Ö–µ–º–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö

### Variant

```json
{
  "attributes": {
    "length": { "type": "integer" },
    "stock": { "type": "integer" },
    "price": { "type": "decimal" },        // –¶—ñ–Ω–∞ –ø—Ä–æ–¥–∞–∂—É
    "costPrice": { "type": "decimal" },    // –°–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å
    "flower": {
      "type": "relation",
      "relation": "manyToOne",
      "target": "api::flower.flower"
    }
  }
}
```

### Flower

```json
{
  "attributes": {
    "name": { "type": "string" },
    "slug": { "type": "uid", "targetField": "name" },
    "description": { "type": "blocks" },
    "image": { "type": "media" },
    "variants": {
      "type": "relation",
      "relation": "oneToMany",
      "target": "api::variant.variant",
      "mappedBy": "flower"
    }
  }
}
```

---

## –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤ UI

### –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ç–æ–≤–∞—Ä–∞–º–∏

–¢–∞–±–ª–∏—Ü—è –ø–æ–∫–∞–∑—É—î –≤–∞—Ä—ñ–∞–Ω—Ç–∏ —É —Ñ–æ—Ä–º–∞—Ç—ñ badge:

```
[50 —Å–º ¬∑ 2.50 ‚Üí 150 –≥—Ä–Ω ¬∑ üì¶ 200 —à—Ç]
```

–î–µ:
- `50 —Å–º` - –¥–æ–≤–∂–∏–Ω–∞
- `2.50` - —Å–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å (—è–∫—â–æ —î)
- `‚Üí` - —Å—Ç—Ä—ñ–ª–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥—É
- `150 –≥—Ä–Ω` - —Ü—ñ–Ω–∞ –ø—Ä–æ–¥–∞–∂—É
- `üì¶ 200 —à—Ç` - –∫—ñ–ª—å–∫—ñ—Å—Ç—å –Ω–∞ —Å–∫–ª–∞–¥—ñ

–Ø–∫—â–æ —Å–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å –Ω–µ –≤–∫–∞–∑–∞–Ω–∞, –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ —Ü—ñ–Ω–∞ –ø—Ä–æ–¥–∞–∂—É:

```
[50 —Å–º ¬∑ 150 –≥—Ä–Ω ¬∑ üì¶ 200 —à—Ç]
```

---

## –ú–æ–∂–ª–∏–≤—ñ –ø–æ–º–∏–ª–∫–∏

| –ö–æ–¥ | –ü—Ä–∏—á–∏–Ω–∞ | –†—ñ—à–µ–Ω–Ω—è |
|-----|---------|---------|
| `MISSING_FILE` | –§–∞–π–ª –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ | –í–∏–±—Ä–∞—Ç–∏ —Ñ–∞–π–ª |
| `INVALID_FORMAT` | –ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª—É | –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ .xlsx –∞–±–æ .xls |
| `DUPLICATE_CHECKSUM` | –§–∞–π–ª –≤–∂–µ —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ | –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ "–ü—Ä–∏–º—É—Å–æ–≤–æ —ñ–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏" |
| `VALIDATION_FAILED` | –ü–æ–º–∏–ª–∫–∏ –≤ –¥–∞–Ω–∏—Ö | –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ñ–∞–π–ª –Ω–∞ –ø–æ–º–∏–ª–∫–∏ |
| `NETWORK_ERROR` | –ü–æ–º–∏–ª–∫–∞ –º–µ—Ä–µ–∂—ñ | –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∑'—î–¥–Ω–∞–Ω–Ω—è |

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó

### –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ Excel —Ñ–∞–π–ª—É

1. **–û–±–æ–≤'—è–∑–∫–æ–≤—ñ –∫–æ–ª–æ–Ω–∫–∏:**
   - –ù–∞–∑–≤–∞ —Å–æ—Ä—Ç—É (variety)
   - –î–æ–≤–∂–∏–Ω–∞ –∞–±–æ grade
   - –ö—ñ–ª—å–∫—ñ—Å—Ç—å (units)
   - –¶—ñ–Ω–∞ (price)

2. **–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ñ –Ω–∞–∑–≤–∏ –∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤:**
   - `variety`, `name`, `–Ω–∞–∑–≤–∞` - –¥–ª—è –Ω–∞–∑–≤–∏
   - `length`, `grade`, `–¥–æ–≤–∂–∏–Ω–∞`, `—Å–º` - –¥–ª—è –¥–æ–≤–∂–∏–Ω–∏
   - `qty`, `units`, `–∫—ñ–ª—å–∫—ñ—Å—Ç—å`, `—à—Ç` - –¥–ª—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ
   - `price`, `—Ü—ñ–Ω–∞` - –¥–ª—è —Ü—ñ–Ω–∏

3. **–§–æ—Ä–º–∞—Ç –¥–∞–Ω–∏—Ö:**
   - –î–æ–≤–∂–∏–Ω–∞: `90`, `90cm`, `90 —Å–º`
   - –ö—ñ–ª—å–∫—ñ—Å—Ç—å: —Ü—ñ–ª–µ —á–∏—Å–ª–æ
   - –¶—ñ–Ω–∞: —á–∏—Å–ª–æ –∑ 2 –∑–Ω–∞–∫–∞–º–∏ –ø—ñ—Å–ª—è –∫–æ–º–∏

### Workflow —ñ–º–ø–æ—Ä—Ç—É

1. –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–∞–π–ª ‚Üí "–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏"
2. –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ø–æ–º–∏–ª–∫–∏ —Ç–∞ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è
3. –í–∏–ø—Ä–∞–≤–∏—Ç–∏ —Ñ–∞–π–ª —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ
4. "–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏" —ñ–º–ø–æ—Ä—Ç
5. –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Ü—ñ–Ω–∏ –ø—Ä–æ–¥–∞–∂—É
6. "–ó–±–µ—Ä–µ–≥—Ç–∏ —Ü—ñ–Ω–∏"

---

## –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏

### –í–µ—Ä—Å—ñ—è 2.0 (–ø–æ—Ç–æ—á–Ω–∞)

- ‚úÖ –î–æ–¥–∞–Ω–æ –ø–æ–ª–µ `costPrice` (—Å–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å)
- ‚úÖ –ü—Ä–∏–±—Ä–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Ü—ñ–Ω (–∫—É—Ä—Å + –º–∞—Ä–∂–∞)
- ‚úÖ –î–æ–¥–∞–Ω–æ —Ç–∞–±–ª–∏—Ü—é –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –∑ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è–º –∫—ñ–ª—å–∫–æ—Å—Ç–µ–π
- ‚úÖ –î–æ–¥–∞–Ω–æ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –≤–≤–µ–¥–µ–Ω–Ω—è —Ü—ñ–Ω –ø—Ä–æ–¥–∞–∂—É –ø—ñ—Å–ª—è —ñ–º–ø–æ—Ä—Ç—É
- ‚úÖ –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å–æ–±—ñ–≤–∞—Ä—Ç–æ—Å—Ç—ñ –≤ –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—ñ —Ç–æ–≤–∞—Ä–∞–º–∏

### –í–µ—Ä—Å—ñ—è 2.1 (–ø–æ—Ç–æ—á–Ω–∞)

- ‚úÖ –ê–≥—Ä–µ–≥–∞—Ü—ñ—è –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤ (—Ä—è–¥–∫–∏ –∑ –æ–¥–Ω–∞–∫–æ–≤–∏–º slug+length —Å—É–º—É—é—Ç—å—Å—è)
- ‚úÖ –ü–æ–∫—Ä–∞—â–µ–Ω–∏–π Activity Log –∑ costPrice –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –≤–∞—Ä—Ç–æ—Å—Ç—ñ –ø–æ—Å—Ç–∞–≤–æ–∫
- ‚úÖ –ü–æ–∫—Ä–∞—â–µ–Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –≤ –ø—Ä–µ–≤ º—é (–ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è, –∞–≥—Ä–µ–≥–∞—Ü—ñ—è)
- ‚úÖ –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—ó –ø—ñ–¥ —á–∞—Å —ñ–º–ø–æ—Ä—Ç—É (–Ω–∞–∑–≤–∞ –∫–≤—ñ—Ç–∫–∏)
- ‚úÖ –ü—ñ–¥—Å–≤—ñ—á—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω–µ–Ω–∏—Ö —Ç–∞ –∞–≥—Ä–µ–≥–æ–≤–∞–Ω–∏—Ö —Ä—è–¥–∫—ñ–≤

### –ú–∞–π–±—É—Ç–Ω—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è

- [ ] –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤–ª–∞—Å–Ω–∏—Ö —Å–∏–Ω–æ–Ω—ñ–º—ñ–≤ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—ó –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—ó
- [ ] –ï–∫—Å–ø–æ—Ä—Ç –≤ Excel
- [ ] –Ü—Å—Ç–æ—Ä—ñ—è —ñ–º–ø–æ—Ä—Ç—ñ–≤
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞
- [ ] –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ –∫—É—Ä—Å–∞–º–∏ –≤–∞–ª—é—Ç
